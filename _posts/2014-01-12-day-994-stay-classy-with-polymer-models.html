---
title: 'Day 994: Stay Classy with Polymer Models'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - polymer
category: japhr-by-chris-strom
published: '2014-01-12T23:59:00-05:00'

---

<div class=top-chain-links></div><br />There are two good ways to learn something new: flail around making dumb mistakes and reading smarter people's words and code. Naturally, I prefer the former.<br /><br />In all seriousness, I find it easier to internalize how a language or tool wants me to work if I struggle to make it work the way I think it should. Usually I can learn a thing or two about my subject of study and I inevitably get exposed to smarter people's work while I figure out why my approach does not work. It might seems counter-intuitive, but really, making mistakes—the worse the better—really works well as I learn.<br /><br />But tonight, I try the opposite. I have been working against <a href="http://www.polymer-project.org/">Polymer</a> long enough. It is time that I tried a trick of two that I have picked up along the way. I start with the “model pattern,” for lack of a better name. Actually a better name might simply be the strategy pattern because that is what it really is. But I keep calling it the model pattern when I come across others doing it in Polymer mostly because there is always a <code>model</code> attribute on the Polymer. <br /><br />I don't know why, but I find that real classy. I want to be classy too. And what's more classy that order pizza? So I am going to build an <code>&lt;x-pizza></code> element that can build a pizza for order.<br /><br />I start a new web application with a <a href="http://pub.dartlang.org/">Dart Pub</a> <code>pubspec.yaml</code> that pulls in <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>:<pre class="prettyprint">name: model_example<br />dependencies:<br />  polymer: any<br />dev_dependencies:<br />  unittest: any<br />transformers:<br />- polymer:<br />    entry_points: web/index.html</pre>I start a pizza building homepage to smoke test my model pattern Polymer. I create it as <code>web/index.html</code>:<pre class="prettyprint">&lt;!DOCTYPE html><br />&lt;html lang="en"><br />  &lt;head><br />    &lt;title>Pizza Maker&lt;/title><br /><b>    &lt;!-- Load component(s) --><br />    &lt;link rel="import" href="packages/model_example/elements/x-pizza.html"><br />    &lt;!-- Load Polymer --><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></b><br />  &lt;/head><br />  &lt;body><br />    &lt;div class="container"><br />      &lt;h1>Dart Bros. Pizza Builder&lt;/h1><br /><b>      &lt;x-pizza>&lt;/x-pizza></b><br />    &lt;/div><br />  &lt;/body><br />&lt;/html></pre>That is almost boilerplate at this point. I pull in the Polymer definition and the Polymer.dart platform at top. Then I use the <code>&lt;x-pizza></code> element below.<br /><br />Similarly, the <code>&lt;x-pizza></code> definition is fairly straight-forward. I create <code>lib/elements/x-pizza.html</code> as:<pre class="prettyprint">&lt;polymer-element name="x-pizza"><br />  &lt;template><br />    &lt;h2>Build Your Pizza&lt;/h2><br />    &lt;pre>{{pizzaState}}&lt;/pre><br />    &lt;p><br />      &lt;select class="form-control" value="{{currentFirstHalf}}"><br />        &lt;option>Choose an ingredient...&lt;/option><br />        &lt;option value="{{ingredient}}" template repeat="{{ingredient in ingredients}}"><br />          {{ingredient}}<br />        &lt;/option><br />      &lt;/select><br />      &lt;button on-click="{{addFirstHalf}}" type="button" class="btn btn-default"><br />        Add First Half Topping<br />      &lt;/button><br />    &lt;/p><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script type="application/dart" src="x_pizza.dart">&lt;/script><br />&lt;/polymer-element></pre>That is just variable binding in templates.<br /><br />The bulk of the work comes in the backing class, which needs a Pizza class:<pre class='prettyprint'>class Pizza {<br />  List&lt;String> firstHalfToppings = [];<br />  List&lt;String> secondHalfToppings = [];<br />  List&lt;String> wholeToppings = [];<br />  toString()=> """First Half: $firstHalfToppings<br />Second Half: $secondHalfToppings<br />Whole: $wholeToppings""";<br />}<br /></pre>To use that as a model, I need only define an instance variable cleverly named “model” and assign an instance of <code>Pizza</code> to it:<pre class="prettyprint">@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  final bool applyAuthorStyles = true;<br />  final List ingredients = [<br />    'pepperoni',<br />    'sausage',<br />    'green peppers'<br />  ];<br /><br />  @observable String currentFirstHalf = 'Choose an ingredient...';<br />  // ...<br />  @observable String pizzaState;<br /><br /><b>  Pizza model = new Pizza();</b><br /><br />  XPizza.created(): super.created();<br />}<br /></pre>All that is needed at this point is to use the model, which I do in the various add-toppings bound methods:<pre class="prettyprint">@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  addFirstHalf() {<br /><b>    model.firstHalfToppings.add(currentFirstHalf);<br />    pizzaState = model.toString();</b><br />  }<br />  // ...<br />}</pre>And that does the trick:<br /><br /><a href="http://3.bp.blogspot.com/-T5rhfAYOW1M/UtNwBi_8RKI/AAAAAAAAU0Y/AjpLT5e3p5I/s1600/01-pizza_model.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-T5rhfAYOW1M/UtNwBi_8RKI/AAAAAAAAU0Y/AjpLT5e3p5I/s640/01-pizza_model.png" /></a><br /><br />That is not quite the end of the story, however. I should be able to make the model itself observable so that, when its internal state is updated, it can trigger the update to the value displayed to the hungry buyer. I will leave that for another day. For now, I am happy just being on the way to classiness.<br /><br /><br /><span style="color: #ccc">Day #994</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/day-993-vulcanize-with-exclusions.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/day-995-observing-model-attributes-in.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
