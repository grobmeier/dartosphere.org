---
title: 'Dartsweeper: Dev Journal 1'
layout: post
tags:
    - dartlang
    - Dartsweeper
    - internet
    - Programming
category: kevinwork
published: '2012-08-16T11:16:00-07:00'

---

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://sweeper.j832.com/" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="508" src="http://4.bp.blogspot.com/-guDQMXuKIRw/UCwIcfruSEI/AAAAAAAAHCk/QXIRrykUkCI/s640/Screen+Shot+2012-08-15+at+4.36.53+PM.png" width="640" /></a></td></tr></tbody></table><a href="http://en.wikipedia.org/wiki/Wikipedia:Too_long;_didn't_read">tl;dr</a>: I'm building a version of <a href="http://en.wikipedia.org/wiki/Minesweeper_(video_game)">Minesweeper</a> in <a href="http://www.dartlang.org/">Dart</a>&nbsp;as an example of&nbsp;something straight-forward and fun. I hope to show how to build Dart apps and demonstrate why Dart is a great tool for building web&nbsp;experiences. Play it <a href="http://sweeper.j832.com/"><span id="goog_107169435"></span>here<span id="goog_107169436"></span></a>. Check out the <a href="https://github.com/kevmoo/sweeper.dart">code on Github</a>. Watch my blog for updates in the next few weeks.<br /><h2>Intro</h2>I'm having a lot of fun with Dart. It's a great intersection of the things I love about other platforms.<br /><ul><li>The open source goodness of Ruby and Python.</li><li>The type goodness of C# and Java--which lights up a productive IDE development experience.</li><li>The run everywhere goodness of Javascript.</li></ul>I've built a <a href="https://github.com/kevmoo/dartlib">couple</a> <a href="https://github.com/kevmoo/vote.dart">projects</a> in Dart, but I wanted to build something for newbies.<br /><h2>Getting the Code</h2><div>Dartsweeper uses my <a href="https://github.com/kevmoo/dartlib">Dartlib</a> library. I haven't quite migrated Dartlib to <a href="http://www.dartlang.org/docs/pub-package-manager/">pub</a>. If you want to play with the code, make sure you download (or git clone) both the code for Dartsweeper and Dartlib and put them in adjacent directories.</div><div><ul><li>source_code</li><ul><li>sweeper.dart</li><ul><li>lib</li><li>html</li><li>readme.md (for sweeper)</li><li>...</li></ul><li>dartlib</li><ul><li>bin</li><li>docs</li><li>readme.md (for dartlib)</li><li>...</li></ul></ul></ul>If you're using <a href="http://www.dartlang.org/docs/editor/">Dart Editor</a>,&nbsp;which I recommend, open both directories to see all of the code.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ivuASKIiSd0/UC0zfaMWCeI/AAAAAAAAHDs/njxVgAL-AJE/s1600/Screen+Shot+2012-08-16+at+1.52.32+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ivuASKIiSd0/UC0zfaMWCeI/AAAAAAAAHDs/njxVgAL-AJE/s1600/Screen+Shot+2012-08-16+at+1.52.32+PM.png" /></a></div><h2>Approach</h2>Honestly, I'm a bit confused and tired of the whole MVVMVPMVC discussion.<br /><br />Let me put my approach simply: <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">Separation&nbsp;of Concern (SOC)</a>. Build small pieces that do a small set of things and connect them in clean ways. It enables easy unit testing. It enables flexible architecture. It avoids <a href="http://en.wiktionary.org/wiki/bikeshedding">bike shedding</a> about what's the V or the C or the VM or the P.<br /><br />The other acronym I'll hang my hat on: <a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a>. Test-driven development is amazing generally, but especially for games. Games often have states that take a while to get to--like winning. Games that have random state--like Dartsweeper--can also suffer from obscure edge casses that one can only find by playing a lot.<br /><br />It ends up being much easier to just point a unit test at a Game object and have it hammer through a large number of game states.<br /><br />But I'm getting ahead of myself. Follow along in the <a href="https://github.com/kevmoo/sweeper.dart/tree/master/lib">lib directory</a> in the repo.<br /><h3>lib/sweeper directory</h3><div>Main logic of the game. Nothing UI-specific.</div><br /><ul><li><b>Field</b>: The read-only, 2-D collection of squares. Booleans. True if it's a mine. Also exposes the adjacent count to make rendering numbers easy.</li><li><b>Game</b>: The core logic. Tracks the state of the game. Allows revealing and flagging. Exposes the duration of the game.</li><li><b>GameState</b> and <b>SquareState</b>: enum-like classes for recording the state of the game or individual squares</li></ul>Take a look at the associated <a href="https://github.com/kevmoo/sweeper.dart/tree/master/test/sweeper">unit tests</a>. Dart advertises itself as "batteries included". An example: the core libraries include a really nice unit test framework.<br /><h3>lib/html</h3>The HTML version of the game.<br /><ul><li><b>GameView</b>:&nbsp;Populates the provided DOM elements and wires up event handles.</li></ul><h3>html</h3><div>Where you actual application exists.</div><div><ul><li><b>sweeper_demo.dart</b>: A tiny bit of code that imports the game logic and the html logic, finds the target elements in the page, and creates the GameView.</li><li><b>index.html</b>: Defines the elements for the app. Aside from a couple of special script tags, it's just HTML, which is the point.</li><li><b>style.css</b>: Just styles. Nothing special.</li></ul></div><h2>Experience</h2>So far I haven't hit many big issues with the app. It's a joy to work in an IDE with a typed language.<br /><br />I'm much less scared about refactoring code in Dart because I get warnings if I've forgotten to rename a variable or if I'm missing an argument to a method. Not only does the type system make initial development faster (with features like member completion), it makes code maintenance easier. This is a huge win.<br /><br />Being able to debug Dart source directly (instead of generated javascript) also greatly improves productivity.<br /><br />I have hit a couple of bumps, though.<br /><h2>Issues</h2><h3>Compiled Javascript size</h3><div>It's huge. Far bigger than the source Dart code in my project. It's been the source of mockery on Hacker News, etc.</div><div><br /></div><div>While it's a bit annoying now, I'm not worried. At the moment, compiler processes all of the imported libraries (even the code that's not used) and generates output that's not minified. Tools like the <a href="https://developers.google.com/closure/compiler/">Closure Compiler</a> have shown this a solved problem. The Dart team is worried about stability and correctness now, as they should. I'm patient.</div><h3>Minor cross-browser issues</h3><div>I was using MouseEvent.toElement, which is not supported in FireFox. I <a href="https://github.com/kevmoo/sweeper.dart/commit/4057d58a84c776c2fc7b6b3205e8e9766238a5da#diff-1">moved to MouseEvent.currentTarget</a> and everything now works. This is a case where having the uncompressed javascript output was a good thing. It was debug the output to find the problem.&nbsp;</div><h2>Future</h2><div>Canvas, sound, mobile. I already have a nice set of retained graphics libraries in Dartlib. I going to dive in with animations and the <a href="http://www.html5rocks.com/en/tutorials/webaudio/games/">Web Audio API</a>. I'll keep the existing HTML app in place, since it's such a straight-forward sample. Once I figure out a clean interaction model, I also hope to make Dartsweeper sing on phones and tables.<br /><br />I'm excited to see how much I can light up this app with Dart.</div><div><br /></div><div>Stay tuned.</div>
