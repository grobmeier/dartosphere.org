---
title: 'Dartsweeper: Dev Journal 3--Graphics, Animation, Audio'
layout: post
tags:
    - dartlang
    - Dartsweeper
    - Programming
category: kevinwork
published: '2012-09-19T10:17:00-07:00'

---

<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://sweeper.j832.com/" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://3.bp.blogspot.com/-dXHbIXS4qrQ/UFn1-VsqexI/AAAAAAAAHQY/F7N2-fuTsiw/s640/Screen+Shot+2012-09-19+at+12.42.01+PM.png" width="630" /></a></div>I've been busy the last few weeks. I've had to give more time to another gig, so I've slowed my progress on the <strike>Dartsweeper</strike> Pop, Pop, Win! But I've made some great tractions. Check out the demo at <a href="http://sweeper.j832.com/">sweeper.j832.com</a>.<br /><a href="http://draft.blogger.com/"></a><br /><h2>Graphics and animation with TexturePacker</h2><div>Graphics for the Pop, Pop Win! (PPW) are packaged using <a href="http://www.codeandweb.com/texturepacker">TexturePacker</a>. TexturePacker takes a number of source images and produces an optimized <a href="http://www.altdevblogaday.com/2012/09/17/building-an-html5-game-dont-shrug-off-atlases/" target="_blank">texture atlas</a>.<br /><br />PPW has two texture files: <a href="http://sweeper.j832.com/dart_opaque_01.jpg" target="_blank">one for square textures</a> (that don't have transparency) and <a href="http://sweeper.j832.com/dart_transparent_01.png" target="_blank">one for the textures that need transparency</a>. Using a jpeg for the textures that don't require transparency saves a lot of bandwidth.<br /><br />TexturePacker outputs a map file that provides the location of each source image in the output map. Initially I was given an XML file which I parsed with the&nbsp;<a href="https://github.com/prujohn/dart-xml" target="_blank">dart-xml</a> library. (Thanks, <a href="https://plus.google.com/115427174005651655317/posts">John</a>!) I converted the XML to JSON which I stored as a string in code and deserialized with <a href="http://api.dartlang.org/docs/continuous/dart_json.html" target="_blank">dart:json</a>.<br /><br />Then I realized I was being dumb.<br /><br />First, I learned TexturePacker can output json directly. So long xml parsing.<br /><br />Second, I realized that valid json can be provided as a literal for <a href="http://api.dartlang.org/docs/continuous/dart_core/Map.html" target="_blank">Map</a> in Dart. Goodbye JSON decoding.<br /><br />Using some simple canvas tricks, I can now easily display graphics and animations representing over one hundred source textures using only two input files.</div><h2>Audio</h2><div>Supporting audio is super easy with <a href="http://api.dartlang.org/docs/continuous/dart_html/AudioContext.html" target="_blank">AudioContext</a>. I started with the <a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/js/buffer-loader.js" target="_blank">BufferLoader</a> sample from an <a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/" target="_blank">HTML5 Rocks tutorial</a> and converted it to Dart.<br /><br />I went a bit further and generalized all of my resource loading into an abstract ResourceLoader class which is then subclassed by ImageLoader and AudioLoader. I plan to migrate these classes into <a href="https://github.com/kevmoo/dartlib">dartlib</a> in the near future.<br /><br />Easy.</div><h2>Issues</h2><div>In my <a href="http://work.j832.com/2012/08/dartsweeper-dev-journal-2-now-with.html" target="_blank">last post</a>, I mentioned an issue using offsetX and offsetY in MouseEvent in Firefox. The <a href="http://code.google.com/p/dart/issues/detail?id=1087" target="_blank">bug has been fixed</a> so I removed my work around.<br /><br />The other glaring issue is the lack of audio support on browsers other than Chrome. Chrome is the only browser that supports AudioContext (that I tried). I've dealt with cross-browser game audio before--see Agent8ball--and I'm not super excited to fix it here. In the mean, just use Chrome.</div><h2>Next Steps</h2><div><br /><ul><li>A few more graphics tweaks.</li><li>A few more sound effects.</li><li>Mobile support.</li><li>Some loading UI.&nbsp;</li></ul></div><h2>You can help</h2><div>Don't forget all the <a href="https://github.com/kevmoo/sweeper.dart" target="_blank">source is on GitHub</a>. <a href="https://github.com/kevmoo/sweeper.dart/issues">Open issues</a>. Fork it.<br /><br />Let me know if you have any questions.<br /><br />Happy hacking...and popping.</div>
