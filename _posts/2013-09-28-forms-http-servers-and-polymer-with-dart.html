---
title: 'Forms, HTTP servers, and Polymer with Dart'
layout: post
tags:
    - dart
    - dartlang
    - polymer
category: seth-ladds-blog
published: '2013-09-28T17:38:00-07:00'

---

(Update of this old <a href="http://blog.sethladd.com/2013/06/forms-http-servers-and-web-components.html">Web UI post</a>. Updated as of Jan 17, 2014 and Dart 1.1.)<br /><br />Dart can be used on the client and the server. This post shows how to:<br /><br /><ul><li>build a form as a custom element</li><li>bind input fields to a Dart object</li><li>build a Dart HTTP server</li><li>handle and parse a form submit</li></ul><div><div class="separator" style="clear: both; text-align: center;"><img border="0" src="http://4.bp.blogspot.com/-cYtkxMP-rYw/Ukd5EYqI_II/AAAAAAAAbkQ/e_pFosam_mg/s640/Sample_app_and_Server_Rack_1_w_Horizon_Server___Flickr_-_Photo_Sharing_.png" height="313" width="640" /></div><br /></div><br /><div>For lots more Polymer.dart examples, be sure to check out the <a href="https://github.com/sethladd/dart-polymer-dart-examples">Dart Polymer Samples</a>. You can find the <a href="https://github.com/sethladd/dart-example-form-submit">code for this post</a> at my Github account.</div><div><h2>Step 1: Install the packages</h2><div>Open up pubspec.yaml (used by the pub package manager) and add the dependencies for Polymer.dart and http_server.</div><div><br /></div><pre class="prettyprint"><code>name: parse_form_submit<br />description: A sample Polymer application<br />dependencies:<br />  polymer: any<br />  http_server: any<br /></code></pre><br /><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/pubspec.yaml">Source for pubspec.yaml</a>.</div><div><h2>Step 2: Create the model class</h2><div>This class is for the "business object". It is bound to the form, so we make its fields observable.</div><div><br /></div><pre class="prettyprint"><code>library models;<br /><br />import 'package:polymer/polymer.dart';<br /><br />class Person extends Object with Observable {<br />  @observable String firstName;<br />  @observable String lastName;<br />  @observable int age = 0;<br />}<br /></code></pre><div><br /></div><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/web/models.dart">Source for models.dart</a>.</div><div><h2>Step 3: Create the custom element HTML</h2><div><br /></div><div>This custom element, brought to you by Polymer.dart, wraps the form and makes it easy to reuse. The &lt;template&gt; tag contains the structure of this custom element. The submit event runs the doSubmit() method of this custom component (see in the next step).</div><div><br /></div><div>A Dart class, linked by the &lt;script&gt; tag, backs this custom element.</div><div><br /></div><pre class="prettyprint"><code>&lt;!DOCTYPE html&gt;<br /><br />&lt;polymer-element name="person-form" attributes="action"&gt;<br />  &lt;template&gt;<br />    &lt;div id="message"&gt;&lt;/div&gt;<br />    &lt;form method="post" on-submit="{{doSubmit}}"&gt;<br />      &lt;div&gt;<br />        First name: &lt;input type="text" value="{{person.firstName}}" name="firstName"&gt;<br />      &lt;/div&gt;<br />      &lt;div&gt;<br />        Last name: &lt;input type="text" value="{{person.lastName}}" name="lastName"&gt;<br />      &lt;/div&gt;<br />      &lt;div&gt;<br />        Age: &lt;input type="number" value="{{person.age | asInteger}}" name="age"&gt;<br />      &lt;/div&gt;<br />      &lt;div&gt;<br />        &lt;input type="submit"&gt;<br />      &lt;/div&gt;<br />    &lt;/form&gt;<br />  &lt;/template&gt;<br />  &lt;script type="application/dart" src="person_form.dart"&gt;&lt;/script&gt;<br />&lt;/polymer-element&gt;<br /><br /></code></pre><div><br /></div><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/web/person_form.html">Source for person_form.html</a>.</div><div><h2>Step 4: Create the custom element Dart code</h2><div>If a custom element needs custom behavior, you can implement it with Dart. Each custom element tag you use on the page has an instance of its corresponding class. Here, the PersonForm class goes with the &lt;person-form&gt; tag.</div><div><br /></div><div>The doSubmit() method is called when the form is submitted (see the on-submit binding from Step 3).</div><div><br /></div><div>In this case, we disable the default behavior of form submission so we don't incur a page reload. We use HttpRequest to submit the form data, and update a div inside our custom element with the response text.</div><div><br /></div><pre class="prettyprint"><code>import 'package:polymer/polymer.dart';<br />import 'models.dart';<br />import 'dart:html';<br />import 'ui_filters.dart' show StringToInt;<br />import 'package:polymer_expressions/filter.dart' show Transformer;<br /><br />@CustomTag('person-form')<br />class PersonForm extends PolymerElement {<br />  final Person person = new Person();<br /><br />  PersonForm.created() : super.created();<br /><br />  @published String action;<br /><br />  doSubmit(Event e, var detail, Node target) {<br />    e.preventDefault();<br /><br />    FormElement form = target as FormElement;<br />    form.action = action;<br /><br />    HttpRequest.request(action,<br />          method: form.method,<br />          sendData: new FormData(form))<br />        .then((HttpRequest req) {<br />          shadowRoot.querySelector('#message').text = req.responseText;<br />        })<br />        .catchError((e) =&gt; print(e));<br />  }<br /><br />  // Filters and transformers can be referenced as fields.<br />  final Transformer asInteger = new StringToInt();<br />}<br /></code></pre><div><br /></div><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/web/person_form.dart">Source for person_form.dart</a>.</div><div><h2>Step 5: Import and use the custom element</h2><div>Use a &lt;link&gt; tag to import the custom element. You must also export polymer/init.dart, which helps to initialize the app.</div><div><div><br /></div><pre class="prettyprint"><code>&lt;!DOCTYPE html&gt;<br /><br />&lt;html&gt;<br />  &lt;head&gt;<br />    &lt;meta charset="utf-8"&gt;<br />    &lt;title&gt;Sample app&lt;/title&gt;<br />    &lt;link rel="stylesheet" href="parse_form_submit.css"&gt;<br />    &lt;link rel="import" href="person_form.html"&gt;<br />    &lt;script type="application/dart"&gt;export 'package:polymer/init.dart';&lt;/script&gt;<br />    &lt;script src="packages/browser/dart.js"&gt;&lt;/script&gt;<br />  &lt;/head&gt;<br />  &lt;body&gt;<br />    &lt;h1&gt;Forms&lt;/h1&gt;<br /><br />    &lt;person-form action="http://localhost:8888/submit"&gt;&lt;/person-form&gt;<br /><br />  &lt;/body&gt;<br />&lt;/html&gt;<br /><br /></code></pre><div><br /></div><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/web/index.html">Source for index.html</a>.</div><div><h2>Step 6: Write the server</h2><div>Dart's dart:io library help you write command-line and server-side application. We use the http_server package for additional HTTP server functionality. The server listens for POST requests, parses the form data into a Map, enable CORS headers (so pages from any origin can submit to this server), and sends back a string version of the original form data.</div><div><br /></div><pre class="prettyprint"><code>import 'dart:io';<br />import 'package:http_server/http_server.dart';<br /><br />echo(HttpRequest req) {<br />  print('received submit');<br />  HttpBodyHandler.processRequest(req).then((HttpBody body) {<br />    print(body.body.runtimeType); // Map<br />    req.response<br />      ..headers.add('Access-Control-Allow-Origin', '*')<br />      ..headers.add('Content-Type', 'text/plain')<br />      ..statusCode = 201<br />      ..write(body.body.toString())<br />      ..close();<br />  });<br />}<br /><br />main() {<br />  HttpServer.bind('0.0.0.0', 8888).then((HttpServer server) {<br />    print('Server is running');<br />    server.listen((HttpRequest req) {<br />      if (req.uri.path == '/submit' &amp;&amp; req.method == 'POST') {<br />        echo(req);<br />      }<br />    });<br />  });<br />}<br /></code></pre><div><br /></div><div><a href="https://github.com/sethladd/dart-example-form-submit/blob/master/bin/server.dart">Source for server.dart</a>.</div><div><br /></div><div><h2>Summary</h2><div>Ta da! You've just used Dart to create a live, data-bound form and wrapped it up in a web component. Then, you wrote a Dart server to parse the form data and return a simple response. Be sure to checkout the <a href="https://github.com/sethladd/dart-example-form-submit">Github repo for this post</a> for all the code. Is this the best we can do? Probably not, you probably want a more full-featured server-side framework. There are a few in pub.dartlang.org for you to explore.</div><div><br /></div><h2>Learning more</h2><div>To learn more about Dart, try these resources:</div><div><ul><li><a href="https://www.dartlang.org/docs/tutorials/">Dart tutorials</a></li><li><a href="http://g.co/dartisans">Dartisans community on G+</a></li><li><a href="https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html">Dart language tour</a></li><li><a href="https://www.dartlang.org/articles/">Dart articles</a></li></ul></div></div></div></div></div></div></div></div></div><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/iXAzlSriWE0" height="1" width="1"/>
