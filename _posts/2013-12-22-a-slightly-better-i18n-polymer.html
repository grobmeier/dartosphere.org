---
title: 'A Slightly Better i18n Polymer'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - i18n
    - polymer
category: japhr-by-chris-strom
published: '2013-12-22T23:59:00-05:00'

---

<div class=top-chain-links></div><br />Last night, I got application-wide localization working in my <a href="http://www.polymer-project.org/">Polymer</a> application. It is not real internationalization and localization—it only allows for a single application-wide localization, but it is a start. Tonight, I hope to use some of <a href="http://dartlang.org">Dart</a>'s <code>intl</code> package to come up with something better. Specifically, I would like to be able to dynamically change the locale at runtime.<br /><br />There is an <a href="http://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/samples/polymer_intl/">example of Polymer internationalization</a> in the Dart repository. I am not quite following along with that, but it does prove invaluable.<br /><br />Yesterday's solution relied on attributes and <code>&lt;content></code> tags to include information from other locales:<pre class="prettyprint"><code>      &lt;hello-you hello="Bonjour" done="Fin"><br />        &lt;p>Présentez-vous une expérience personnalisée incroyable!&lt;/p><br />      &lt;/hello-you></code></pre>Those attributes and <code>&lt;content></code> are then included in the template as:<pre class="prettyprint">&lt;polymer-element name="hello-you"><br />  &lt;template><br />    &lt;div><br /><b>      &lt;h2>{{hello}} {{your_name}}&lt;/h2></b><br />      &lt;p><br />        &lt;input value="{{your_name}}"><br />        &lt;input type=submit value="{{done}}!" on-click="{{feelingLucky}}"><br />      &lt;/p><br /><b>      &lt;p class=instructions><br />        &lt;content>&lt;/content><br />      &lt;/p></b><br />    &lt;/div><br />  &lt;/template><br />  &lt;script type="application/dart" src="hello_you.dart">&lt;/script><br />&lt;/polymer-element></pre>As I mentioned, the attributes like <code>hello</code> and <code>done</code> have to to hard-coded in the page for this approach to work. Instead, I want those properties to be dynamic getters.<br /><br />In the end, I do not even use the <code>intl</code> package, which seems useful for strings requiring parameters (numbers or dates). I find that I can achieve what I want with a <code>Labels</code> class like:<pre class="prettyprint">class Labels {<br />  var locale;<br />  Labels(this.locale);<br /><br /><b>  operator [](label) {<br />    var lookup;<br />    switch (locale) {<br />      case 'fr' : lookup = fr; break;<br />      default: lookup = en;<br />    }<br /><br />    return lookup[label];<br />  }</b><br /><br />  static Map get en => {<br />    'hello': 'Hello',<br />    'done': 'Done',<br />    'instructions': 'Introduce yourself for an amazing personalized experience!'<br />  };<br /><br />  static Map get fr => {<br />    'hello': 'Bonjour',<br />    'done': 'Fin',<br />    'instructions': 'Présentez-vous une expérience personnalisée incroyable!'<br />  };<br />}</pre>The localized labels are included as static methods. An instance of the <code>Labels</code> class provides an <code>[]</code> lookup, switching the labels based on the current locale.<br /><br />The various getters in the Polymer can then be written as lookups of <code>Labels</code>:<pre class="prettyprint">@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  // ...<br />  @published String locale = 'en';<br /><br />  HelloYou.created(): super.created();<br /><br /><b>  String get hello => _labels['hello'];<br />  String get done => _labels['done'];<br />  String get instructions => _labels['instructions'];</b><br /><br />  var __labels;<br />  get _labels {<br />    if (__labels == null) __labels = new Labels(locale);<br />    return __labels;<br />  }<br />  // ...<br />}</pre>That still will not quite work if I wanted to allow a human to change the locale on the fly, but it allows the Polymer to change locales with a simple attribute:<pre class="prettyprint">&lt;hello-you locale="fr">&lt;/hello-you></pre>Which results in:<br /><br /><a href="http://1.bp.blogspot.com/-ToQtvDlWVOA/UrfH9Zhlx3I/AAAAAAAAUgc/784rORCchCI/s1600/03-l10n_complete.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-ToQtvDlWVOA/UrfH9Zhlx3I/AAAAAAAAUgc/784rORCchCI/s640/03-l10n_complete.png" /></a><br /><br />I will pick back up tomorrow trying to allow a human to hot swap locales. I would also like to come up with a contrived example to use for <code>intl</code> messages. I do not think that I will end up using them in <a href="http://patternsinpolymer.com">Patterns in Polymer</a> (there's not an easy JavaScript equivalent), but I misunderstood them badly enough tonight to confuse myself into thinking that I needed them. This seems a fine chance to understand what they really can do.<br /><br /><br /><span style="color: #ccc">Day #973</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2013/12/silly-polymer-i18n.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2013/12/dart-intlmessage.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
