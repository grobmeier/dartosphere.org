---
title: 'Dart: An Algorithm to Unindent Code'
layout: post
tags:
    - 'computer science'
    - dartlang
category: jjinuxland
published: '2012-09-24T14:21:00-07:00'

---

<div dir="ltr" style="text-align: left;" trbidi="on"> <p>Have you ever had to write an algorithm to unindent a block of code consistently? Figuring out the maximum amount of whitespace among all the lines and then removing that amount of whitespace is non-trivial. Remembering to ignore lines that only have whitespace makes the problem even harder. Here's some Dart code that I wrote to do it. I do believe the performance is O(num_lines * max_line_length), which I think is optimal. It should be easy to port this to other languages if you need it:</p> <pre>/**<br /> * Remove the indentation from the given lines.<br /> * <br /> * Only remove as much indentation as the line with the least amount of<br /> * indentation.<br /> */<br />List&lt;String&gt; unindentFilter(List&lt;String&gt; lines) {<br />  // Make a copy so that we can modify it in place.<br />  lines = new List&lt;String&gt;.from(lines);<br />  <br />  // Make sure there is at least one line.<br />  if (!lines.isEmpty()) {<br />  <br />    // Figure out how much indentation the first line has.<br />    var indentation = new List&lt;String&gt;();<br />    for (String char in lines[0].splitChars()) {<br />      if (char == &quot; &quot; || char == &quot;\t&quot;) {<br />        indentation.add(char);<br />      } else {<br />        break;<br />      }      <br />    }<br />    <br />    // Figure out the least amount of indentation any of the other lines has.<br />    for (var i = 1; i &lt; lines.length; i++) {<br />      String line = lines[i];<br />      List&lt;String&gt; chars = line.splitChars();<br />      <br />      // Lines that only have whitespace should be set to &quot;&quot; and ignored.<br />      var whitespaceOnly = true;<br />      for (var char in chars) {<br />        if (char != &quot; &quot; &amp;&amp; char != &quot;\t&quot;) {<br />          whitespaceOnly = false;<br />          break;<br />        }          <br />      }<br />      if (whitespaceOnly) {<br />        lines[i] = &quot;&quot;;          <br />      } else {<br />        <br />        // If the line has something other than whitespace, see how its<br />        // indentation compares to the least amount of indentation we've<br />        // seen so far.<br />        for (var j = 0; j &lt; indentation.length &amp;&amp; j &lt; chars.length; j++) {<br />          String char = chars[j];<br />          if ((char != &quot; &quot; &amp;&amp; char != &quot;\t&quot;) ||<br />              char != indentation[j]) {<br />            <br />            // We found a new line with less indentation.<br />            indentation.removeRange(j, indentation.length - j);<br />            break;<br />          } <br />        }<br />      }<br />    }<br />    <br />    // Loop over all the lines, and remove the right amount of indentation.<br />    for (var i = 0; i &lt; lines.length; i++) {<br />      String line = lines[i];<br />      <br />      // Ignore blank lines.<br />      if (line != &quot;&quot;) {<br />        <br />        // Otherwise, trim off the right amount of indentation.<br />        List&lt;String&gt; chars = line.splitChars();<br />        List&lt;String&gt; unindented = chars.getRange(indentation.length, chars.length - indentation.length);<br />        lines[i] = Strings.concatAll(unindented);<br />      }<br />    }<br />  }<br />  <br />  return lines;<br />}</pre> <p>Here are some tests:</p> <pre>test(&quot;unindentFilter unindents code&quot;, () {<br />  expect(merger.unindentFilter([&quot;  1&quot;,<br />                                &quot;  2&quot;]),<br />         equals([&quot;1&quot;,<br />                 &quot;2&quot;]));<br />});<br /><br />test(&quot;unindentFilter unindents code where the first line is indented the most&quot;, () {<br />  expect(merger.unindentFilter([&quot;\t    1&quot;,<br />                                &quot;\t  2&quot;,<br />                                &quot;\t    3&quot;]),<br />         equals([&quot;  1&quot;,<br />                 &quot;2&quot;,<br />                 &quot;  3&quot;]));<br />});<br /><br />test(&quot;unindentFilter does nothing for unindented code&quot;, () {<br />  expect(merger.unindentFilter([&quot;1&quot;,<br />                                &quot;2&quot;,<br />                                &quot;3&quot;]),<br />         equals([&quot;1&quot;,<br />                 &quot;2&quot;,<br />                 &quot;3&quot;]));<br />});<br /><br />test(&quot;unindentFilter handles empty lists&quot;, () {<br />  expect(merger.unindentFilter([]),<br />         equals([]));<br />});<br /><br />test(&quot;unindentFilter does not try to handle inconsistent indentation&quot;, () {<br />  expect(merger.unindentFilter([&quot;\t1&quot;,<br />                                &quot;  2&quot;,<br />                                &quot;    3&quot;<br />                                &quot;        4&quot;]),<br />         equals([&quot;\t1&quot;,<br />                 &quot;  2&quot;,<br />                 &quot;    3&quot;<br />                 &quot;        4&quot;]));<br />});<br /><br />test(&quot;unindentFilter handles really awkward short lines&quot;, () {<br />  expect(merger.unindentFilter([&quot;    1&quot;,<br />                                &quot;2&quot;]),<br />         equals([&quot;    1&quot;,<br />                 &quot;2&quot;]));<br />});<br /><br />test(&quot;unindentFilter handles blank lines and lines with only indentation&quot;, () {<br />  expect(merger.unindentFilter([&quot;  1&quot;,<br />                                &quot;&quot;,<br />                                &quot; &quot;,<br />                                &quot;    2&quot;]),<br />         equals([&quot;1&quot;,<br />                 &quot;&quot;,<br />                 &quot;&quot;,<br />                 &quot;  2&quot;]));<br />});</pre></div>
