---
title: 'Calling JavaScript Libraries from Polymer.dart'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - js-interop
    - underscorejs
category: japhr-by-chris-strom
published: '2014-01-01T23:55:00-05:00'

---

<div class=top-chain-links></div><br />I started writing a chapter for <a href="http://patternsinpolymer.com">Patterns in Polymer</a> and realized that it really wasn't any kind of pattern—at least not for <a href="http://dartlang.org">Dart</a>. The latest chapter in the book was to discuss using third party libraries with <a href="http://www.polymer-project.org/">Polymer</a>. My problem is that Dart is brilliant at package management. Thanks to <a href="http://pub.dartlang.org/">Dart Pub</a>, using third party libraries is not so much a pattern as it is everyday, humdrum language tools.<br /><br />So what is a poor author to do? Abandon the pattern because it does not apply to both JavaScript and Dart? That does not seem right since it really does take some thinking in JavaScript. Write a JavaScript-only chapter? Rip-off for the readers of the Dart-only version of the book! Instead, I think that I will give it a go using third party <i>JavaScript</i> libraries from <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>. Surely there will be a use case for that so it is not completely contrived. Right?<br /><br />Since my JavaScript example makes use of the <code>debounce()</code> method from the venerable <a href="http://underscorejs.org">Underscore.js</a>, I think that I will try using the same method from Dart. This is a <i>little</i> contrived because debouncing (aka throttling a function so that it cannot happen again until some time has elapsed) is pretty easy in vanilla Dart. Still, there are some things that JavaScript libraries can do that JavaScript cannot just yet. I think. I mean, there must be, right? Well, assuming there are...<br /><br />I start with a basic <code>pubspec.yaml</code> for my example “underscore” application:<pre class="prettyprint">name: underscore<br />dependencies:<br />  polymer: any</pre>A quick <code>pub get</code> and I have all of the Dart dependencies that I am going to need.<br /><br />I start from the outside of my application with the web page that will hold my Underscore-powered <code>&lt;hello-you></code> Polymer:<pre class=prettyprint>&lt;!DOCTYPE html><br />&lt;html lang="en"><br />  &lt;head><br />    &lt;!-- ... --><br />    &lt;!-- Load component(s) --><br /><b>    &lt;link rel="import" href="/packages/underscore/hello-you.html"></b><br />    &lt;!-- Load Polymer --><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script><br />  &lt;/head><br />  &lt;body><br />    &lt;div class="container"><br /><b>      &lt;hello-you>&lt;/hello-you></b><br />    &lt;/div><br />  &lt;/body><br />&lt;/html></pre>There is nothing new there—just importing the <code>&lt;hello-you></code> definition and using it in the page. What is especially nice is that I do not have to declare any JavaScript dependencies or pollute my main page with <code>dart:js</code>-related <code>&lt;script></code> tags. I can do that entirely in my Polymer definition itself.<br /><br />Speaking of the Polymer definition, it looks very much like any other <code>&lt;polymer-element></code> definition, with a <code>&lt;template></code> describing the HTML used and a <code>&lt;script></code> tag referencing the actual code. The only thing out of the ordinary is the opening of the file, which includes the <code>dart:js</code> <code>&lt;script></code> tags and a reference to Underscore:<pre class="prettyprint"><b>&lt;script src="../../packages/browser/dart.js">&lt;/script><br />&lt;script src="../../packages/browser/interop.js">&lt;/script><br />&lt;script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js">&lt;/script></b><br />&lt;polymer-element name="hello-you"><br />  &lt;template><br />    &lt;h2>Hello {{your_name}}&lt;/h2><br />    &lt;p><br />      &lt;input value="{{your_name}}"><br />      &lt;input type=submit value="Colorize!" on-click="{{feelingLucky}}"><br />    &lt;/p><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script type="application/dart" src="hello_you.dart">&lt;/script><br />&lt;/polymer-element></pre>Even if the main web page needed to use some JavaScript of its own, this would still work. The main web page could point <code>&lt;script></code> tags to the same <code>dart:js</code> script tags without worry—modern browsers will retrieve and execute the same script only once.<br /><br />All that remains is the <code>hello_you.dart</code> backing code. It needs to import the <code>dart:js</code> package in order to have access to the nice JavaScript interoperation methods:<pre class="prettyprint">import 'package:polymer/polymer.dart';<br />import 'dart:math';<br /><b>import 'dart:js';</b><br /><br />@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  HelloYou.created(): super.created();<br /><br />  var _debouncedLucky;<br />  feelingLucky() {<br />    _ensureDebouncedLucky();<br /><b>    _debouncedLucky.apply([]);</b><br />  }<br /><br />  _ensureDebouncedLucky() {<br />    if (_debouncedLucky != null) return;<br /><b>    _debouncedLucky = context['_'].callMethod('debounce', [_feelingLucky, 750, true]);</b><br />  }<br /><br />  _feelingLucky() {<br />    // Normal Dart definition here...<br />  }<br />}</pre>In there, I <code>callMethod()</code> on Underscore to get a “debounced” version of the regular <code>_feelingLucky()</code> method. To invoke this JavaScript debounced method whenever the Polymer invokes <code>feelingLucky()</code> via the <code>on-click</code> attribute, I use <code>dart:js</code>'s <code>apply()</code>.<br /><br />And that does the trick:<br /><br /><a href="http://2.bp.blogspot.com/-wtC50ZdLoo8/UsTvdaMSwiI/AAAAAAAAUvM/FfMeu6DRk4s/s1600/01-underscorejs_from_dart.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-wtC50ZdLoo8/UsTvdaMSwiI/AAAAAAAAUvM/FfMeu6DRk4s/s640/01-underscorejs_from_dart.png" /></a><br /><br />I can click the “Colorize!” button as often as I like, but will only see a change if I wait for the debounce-mandated 750 milliseconds between clicks. Nice!<br /><br />As I said, using Underscore from Dart is almost certainly useless. What features of Underscore that are not built into Dart are readily available from packages, including an Underscore Dart package. Still, this is simple enough—and close enough to the JavaScript narrative—that I think it is worth including in the book. <br /><br /><br /><span style="color: #ccc">Day #983</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2013/12/polymer-external-libraries-and-latency.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/creating-polymer-package-for-bower.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
