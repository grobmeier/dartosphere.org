---
title: 'Forms, HTTP servers, and Web Components with Dart'
layout: post
tags:
    - dart
    - dartlang
category: seth-ladds-blog
published: '2013-06-05T19:27:00-07:00'

---

<span style="font-size: x-large;">(<a href="http://blog.sethladd.com/2013/09/forms-http-servers-and-polymer-with-dart.html">UPDATED VERSION HERE</a>. This post is out of date, you probably want the <a href="http://blog.sethladd.com/2013/09/forms-http-servers-and-polymer-with-dart.html">new version</a>.)</span><br /><br />Dart can be used on the client and the server. This post shows how to:<br /><div><ul><li>build a form as a custom element</li><li>bind input fields to a Dart object</li><li>build a Dart HTTP server</li><li>handle and parse a form submit</li></ul><div class="separator" style="clear: both; text-align: center;"><img border="0" height="252" src="http://2.bp.blogspot.com/-i53oGFflxKM/Ua_yhctuZNI/AAAAAAAAXiU/JZsstHI7JUc/s400/4436325865_d627768fa6_b.jpg" width="400" /></div><div><br /></div><div><br /></div><div>For lots more examples, and more context and details, be sure to check out the <a href="http://www.dartlang.org/docs/tutorials/">Dart Tutorials</a>. You can find the <a href="https://github.com/sethladd/dart-form-submit-demo">code</a> for this post at my Github account.</div></div><div><br /></div><div><span style="font-size: large;">Step 1: Install the Web UI package</span></div><div><br /></div><div>Open up pubspec.yaml (used by the <a href="http://pub.dartlang.org/">pub package manager</a>) and add the dependencies for Web UI.</div><div><br /></div><div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">dependencies<span class="s1">:</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; browser<span class="s1">:</span> any</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; web_ui<span class="s1">:</span> any</span></div><div class="p2"><br /></div><div class="p2"><span style="font-size: large;">Step 2: Create the model class</span></div><div class="p2"><br /></div><div class="p2">This class is for our "business object". It is bound to the form, so we make it <a href="http://www.dartlang.org/web-ui/observable">observable</a>.</div><div class="p2"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">library</span> person;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'package:web_ui/web_ui.dart'<span class="s2">;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p4"><span style="font-family: Courier New, Courier, monospace;"><span class="s2">@</span>observable</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">class</span> Person {</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; String <span class="s3">firstName</span>;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; String <span class="s3">lastName</span>;</span></div><div class="p5"><span style="font-family: Courier New, Courier, monospace;"><span class="s2">&nbsp; double </span><span class="s3">age</span><span class="s2"> = </span><span class="s4">0.0</span><span class="s2">;&nbsp; </span>// not an int because web ui loves doubles</span></div><div class="p2"></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">}</span></div><div class="p1"><br /></div><div class="p1"><span style="font-size: large;">Step 3: Create the custom element HTML</span></div><div class="p1"><br /></div><div class="p1">This custom element, polyfilled by <a href="http://www.dartlang.org/articles/web-ui/spec.html">Web UI</a>, wraps the form and makes it easy to reuse. The custom element is bound to an instance of Person, our model class. The &lt;template&gt; tag contains the structure of this custom element. Notice the submit event runs the submit() method of this custom component (see in the next step). The $event object, representing the submit event, is passed to submit().</div><div class="p1"><br /></div><div class="p1"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &lt;<span class="s1">element</span> name=<span class="s2">"person-form"</span> constructor=<span class="s2">"PersonForm"</span> extends=<span class="s2">"div"</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &lt;<span class="s1">template</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">div</span> id=<span class="s2">"message"</span>&gt;&lt;/<span class="s1">div</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">form</span> method=<span class="s2">"post"&nbsp;</span>on-submit="submit($event)"</span><span style="font-family: 'Courier New', Courier, monospace;">&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">input</span> type=<span class="s2">"text"</span> bind-value=<span class="s2">"person.firstName"</span> name=<span class="s2">"firstName"</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">input</span> type=<span class="s2">"text"</span> bind-value=<span class="s2">"person.lastName"</span> name=<span class="s2">"lastName"</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">input</span> type=<span class="s2">"number"</span> bind-value-as-number=<span class="s2">"person.age"</span> name=<span class="s2">"age"</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;<span class="s1">input</span> type=<span class="s2">"submit"</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/<span class="s1">form</span>&gt;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &lt;/<span class="s1">template</span>&gt;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><span class="s3">&nbsp; &nbsp; &nbsp; &lt;</span><span class="s1">script</span><span class="s3"> type=</span>"application/dart"<span class="s3"> src=</span>"personform.dart"<span class="s3">&gt;&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></span></div><div class="p2"></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s3">&nbsp; &nbsp;&nbsp;&lt;/</span>element<span class="s3">&gt;</span></span></div><div class="p3"><span class="s3"><br /></span></div><div class="p3"><span class="s3"><span style="font-size: large;">Step 4: Create the custom element Dart code</span></span></div><div class="p3"><span class="s3"><br /></span></div><div class="p3"><span class="s3">If a custom element needs custom behavior, you can implement it with Dart. Each custom element tag you use on the page as an instance of its corresponding class. The submit() method is called when the form is submitted (see the on-submit binding from Step 3). The person and action fields of the PersonForm class get initialized by attribute and data bindings from the usage of the custom element tag.</span></div><div class="p3"><span class="s3"><br /></span></div><div class="p3"><span class="s3">In this case, we disable the default behavior of form submission so we don't incur a page reload. We use HttpRequest to submit the form data, and update a div inside our custom element with the response text.</span></div><div class="p3"><span class="s3"><br /></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'package:web_ui/web_ui.dart'<span class="s2">;</span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'person.dart'<span class="s2">;</span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'dart:html'<span class="s2">;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">class</span> PersonForm <span class="s1">extends</span> WebComponent {</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; Person <span class="s3">person</span>;</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; String <span class="s3">action</span>;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span></div><div class="p4"><span style="font-family: Courier New, Courier, monospace;">&nbsp; submit(Event e) {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; e.preventDefault();</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; FormElement form = e.target as FormElement;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; form.action = action;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; HttpRequest.request(form.action,</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method:form.method,</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sendData:new FormData(form))</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; .then((HttpRequest req) {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host.query('#message').text = req.responseText;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; })</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; .catchError((e) =&gt; print(e));</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; }</span></div><div class="p3"><span class="s3"><span style="font-family: Courier New, Courier, monospace;">                               </span></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">}</span></div><div class="p3"><br /></div><div class="p3"><span style="font-size: large;">Step 5: Import and use the custom element</span></div><div class="p3"><br /></div><div class="p3">Use a &lt;link&gt; tag to import the custom element. Use the custom element with is="person-form" attribute on a &lt;div&gt;. An instance of person (created in the next step) is bound to the custom element. The action attribute on div is used to set the action via static data binding.</div><div class="p3"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&lt;</span>html<span class="s1">&gt;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &lt;<span class="s2">head</span>&gt;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &lt;<span class="s2">meta</span> charset=<span class="s3">"utf-8"</span>&gt;</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&nbsp; &nbsp; &lt;</span><span class="s2">link</span><span class="s1"> rel=</span>"stylesheet"<span class="s1"> href=</span>"parse_form_submit.css"<span class="s1">&gt;</span></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&nbsp; &nbsp; &lt;</span><span class="s2">link</span><span class="s1"> rel=</span>"import"<span class="s1"> href=</span>"personform.html"<span class="s1">&gt;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &lt;/<span class="s2">head</span>&gt;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &lt;<span class="s2">body</span>&gt;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &lt;<span class="s2">h1</span>&gt;Forms&lt;/<span class="s2">h1</span>&gt;</span></div><div class="p4"><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp; &nbsp;</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&nbsp; &nbsp; &lt;</span><span class="s2">div</span><span class="s1"> action=</span>"http://localhost:8888/submit"<span class="s1"> is=</span>"person-form"<span class="s1"> person=</span>"{{person}}"<span class="s1">&gt;&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span></span></div><div class="p4"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&nbsp; &nbsp; &lt;</span><span class="s2">script</span><span class="s1"> type=</span>"application/dart"<span class="s1"> src=</span>"parse_form_submit.dart"<span class="s1">&gt;&lt;/</span><span class="s2">script</span><span class="s1">&gt;</span></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">&nbsp; &nbsp; &lt;</span><span class="s2">script</span><span class="s1"> src=</span>"packages/browser/dart.js"<span class="s1">&gt;&lt;/script&gt;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &lt;/body&gt;</span></div><div class="p3"></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;">&lt;/html&gt;</span></div><div class="p2"><br /></div><div class="p2"><span style="font-size: large;">Step 6: Create the app's main code</span></div><div class="p2"><br /></div><div class="p2">All this app needs is one instance of Person. The instance defined here is visible to the page, and is the same as used in the custom element from Step 5 (person="{{person}}"). The main() method is empty, because Web UI handles all the binding, initialization, etc.</div><div class="p2"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'person.dart'<span class="s2">;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">Person <span class="s3">person</span> = <span class="s1">new</span> Person();</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p2"></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s4">main</span>() { }</span></div><div class="p3"><br /></div><div class="p3"><span style="font-size: large;">Step 7: Write the server</span></div><div class="p3"><br /></div><div class="p3">Dart's <a href="http://www.dartlang.org/articles/io/">dart:io library</a> help you write command-line and server-side application. We use the builtin HTTP server functionality to listen for POST requests, parse the form data into a Map, enable <a href="http://enable-cors.org/index.html">CORS headers</a> (so pages from any origin can submit to this server), and send back a string version of the original form data.</div><div class="p3"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s1">import</span><span class="s2"> </span>'dart:io'<span class="s2">;</span></span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;"><span class="s3">main</span>() {</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; HttpServer.bind(<span class="s4">'0.0.0.0'</span>, <span class="s5">8888</span>).then((HttpServer server) {</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; server.listen((HttpRequest req) {</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; <span class="s1">if</span> (req.<span class="s6">uri</span>.<span class="s6">path</span> == <span class="s4">'/submit'</span> &amp;&amp; req.<span class="s6">method</span> == <span class="s4">'POST'</span>) {</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s2">&nbsp; &nbsp; &nbsp; &nbsp; print(</span>'received submit'<span class="s2">);</span></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; HttpBodyHandler.processRequest(req).then((HttpBody body) {</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(body.<span class="s6">body</span>.<span class="s7">runtimeType</span>); <span class="s8">// Map</span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; req.</span><span class="s6">response</span><span class="s2">.</span><span class="s6">headers</span><span class="s2">.add(</span>'Access-Control-Allow-Origin'<span class="s2">, </span>'*'<span class="s2">);</span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;"><span class="s2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; req.</span><span class="s6">response</span><span class="s2">.</span><span class="s6">headers</span><span class="s2">.add(</span>'Content-Type'<span class="s2">, </span>'text/plain'<span class="s2">);</span></span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; req.<span class="s6">response</span>.<span class="s6">statusCode</span> = <span class="s5">HttpStatus.CREATED</span>;</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; req.<span class="s6">response</span>.write(body.<span class="s6">body</span>.toString());</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; req.<span class="s6">response</span>.close();</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; });</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; }</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; });</span></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">&nbsp; });</span></div><div class="p3"></div><div class="p3"><span style="font-family: Courier New, Courier, monospace;">}</span></div><div class="p3"><br /></div><div class="p3"><span style="font-size: large;">Summary</span></div><div class="p3"><br /></div><div class="p3">Ta da! You've just used Dart to create a live, data-bound form and wrapped it up in a web component. Then, you wrote a Dart server to parse the form data and return a simple response. Be sure to checkout the <a href="https://github.com/sethladd/dart-form-submit-demo">Github repo</a> for this post for all the code (as I left out a few things). Is this the best we can do? Probably not, you probably want a more full-featured server-side framework. There are a few in <a href="http://pub.dartlang.org/">pub.dartlang.org</a> for you to explore.</div><div class="p3"><br /></div><div class="p3"><span style="font-size: large;">Learning more</span></div><div class="p3"><br /></div><div class="p3">To learn more about Dart, try these resources:</div><div class="p3"></div><ul><li><a href="http://www.dartlang.org/docs/tutorials/">Dart tutorials</a></li><li><a href="http://g.co/dartisans">Dartisans community on G+</a></li><li><a href="https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html">Dart language tour</a></li><li><a href="http://www.dartlang.org/articles/">Dart articles</a></li></ul><br /><div class="p3">Photo Credit: <a href="http://www.flickr.com/photos/25384802@N08/4436325865/">jasleen_kaur</a></div></div><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/-6FKWSNrsBA" height="1" width="1"/>
