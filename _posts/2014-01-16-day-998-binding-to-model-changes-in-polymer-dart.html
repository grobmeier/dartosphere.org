---
title: 'Day 998: Binding to Model Changes in Polymer (Dart)'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - mdv
    - polymer
category: japhr-by-chris-strom
published: '2014-01-16T23:59:00-05:00'

---

<div class=top-chain-links></div><br />Tonight, I hope to better express what needs to update when the <code>Pizza</code> model changes in my <code>&lt;x-pizza></code> <a href="http://www.polymer-project.org/">Polymer</a>. The JavaScript version of Polymer has an observe block to do this, but I cannot find a <a href="http://dartlang.org">Dart</a> equivalent. I came up with a solution (and a pretty good one), but I do not know if it is <i>the</i> solution. And I must strive for <i>the</i> solution in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>.<br /><br />I currently have a simple model driven Polymer that updates the pizza state for display:<br /><br /><a href="http://3.bp.blogspot.com/-taC5yN6_E0s/UtirLcy5EUI/AAAAAAAAU2I/WmTRy2MsEbA/s1600/01-update_pizza_state.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-taC5yN6_E0s/UtirLcy5EUI/AAAAAAAAU2I/WmTRy2MsEbA/s640/01-update_pizza_state.png" /></a><br /><br />Sure, it could use some fancy graphics, but this is fine for illustration and exploration. When a human clicks the add topping buttons, the Polymer adds the selected ingredient to the model. By virtue of property change listeners, the change in the <code>Pizza</code> model results in an update to the current pizza state representation:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  XPizza.created(): super.created() {<br />    model = new Pizza()<br /><b>      ..firstHalfToppings.changes.listen(updatePizzaState)<br />      ..secondHalfToppings.changes.listen(updatePizzaState)<br />      ..wholeToppings.changes.listen(updatePizzaState);</b><br />    // ...<br />  }<br />  // ...<br />}</pre>Thanks to the magic of Dart method cascades, I can establish change listeners for multiple properties on my model.<br /><br />That is nice and all, but the three listeners seem a tad redundant. Really, I would be happier to listen for any changes anywhere in the model—not just changes to those individual properties. Something like that might be expressed as:<pre class="prettyprint">@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  XPizza.created(): super.created() {<br />    model = new Pizza()<br /><b>      ..changes.listen(updatePizzaState);</b><br />    // ...<br />  }<br />  // ...<br />}</pre>I have to admit that this sort of feels like something that an <code>Observable</code> class ought to give me for free. That is, if any observable properties in an observable class change, then the instance changes too. But that is not the case, so I am going to need to manually do this for my <code>Pizza</code> class:<pre class=prettyprint>class Pizza extends Observable {<br />  ObservableList&lt;String> firstHalfToppings = toObservable([]);<br />  ObservableList&lt;String> secondHalfToppings = toObservable([]);<br />  ObservableList&lt;String> wholeToppings = toObservable([]);<br />}</pre>(I am not sure the word “observable” is in there enough)<br /><br />Thankfully, manually notifying that the model has changed in Polymer is directly supported via the <code>notifyChange()</code> method. So, in the <code>Pizza</code> constructor, I listen to the change stream on the individual properties and, whenever such an event occurs, I notify the object itself that a change has occurred:<pre class=prettyprint>class Pizza extends Observable {<br />  ObservableList&lt;String> firstHalfToppings = toObservable([]);<br />  ObservableList&lt;String> secondHalfToppings = toObservable([]);<br />  ObservableList&lt;String> wholeToppings = toObservable([]);<br /><br /><b>  Pizza() {<br />    firstHalfToppings.changes.listen((_)=> notifyChange(_));<br />    secondHalfToppings.changes.listen((_)=> notifyChange(_));<br />    wholeToppings.changes.listen((_)=> notifyChange(_));<br />  }</b><br />}</pre>I think that is pretty close to the spirit of what I want to accomplish. <br /><br />Still, I am surprised that there is nothing closer to <code>observe</code> blocks in the the JavaScript version of Polymer. These let me observe properties via dot notation, invoking the supplied callback when changes are observed:<pre class=prettyprint><code>  observe: {<br />    'model.firstHalfToppings': 'updatePizzaState',<br />    'model.secondHalfToppings': 'updatePizzaState',<br />    'model.wholeToppings': 'updatePizzaState'<br />  },</code></pre>But if that exists, I am unable to find it.<br /><br /><br /><span style="color: #ccc">Day #998</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/day-997-cascade-observers-in-polymer.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/day-999-polymer-and-svg.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
