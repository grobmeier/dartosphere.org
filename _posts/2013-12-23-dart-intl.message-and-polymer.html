---
title: 'Dart Intl.message (and Polymer)'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - i18n
    - polymer
category: japhr-by-chris-strom
published: '2013-12-23T23:59:00-05:00'

---

<div class=top-chain-links></div><br />I have to confess that I am still a little confused by the <code>intl</code> package in <a href="http://dartlang.org">Dart</a>. I think that last night's solution for localizing <a href="http://www.polymer-project.org/">Polymer</a> elements contains pretty much what I need without making any use of the <code>intl</code> package. But I know there must be useful functionality in <code>intl</code> that I am overlooking so tonight I set out to see if I can understand it.<br /><br />Part of my problem is, I think, a forest through the trees situation. The examples in <a href="code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/pkg/intl/">the source code</a> contain a lot of library lookup and base classes that I do not quite follow. Perhaps I can adapt my existing code to the Dart Way™.<br /><br />I currently have maps of label values:<pre class="prettyprint">class Labels {<br />  // ...<br />  static Map get en => {<br />    'hello': 'Hello',<br />    'done': 'Done',<br />    'instructions': 'Introduce yourself for an amazing personalized experience!'<br />  };<br /><br />  static Map get fr => {<br />    'hello': 'Bonjour',<br />    'done': 'Fin',<br />    'instructions': 'Présentez-vous une expérience personnalisée incroyable!'<br />  };<br />}</pre>I can use a locale string to chose one of those maps at runtime to be interpolated into my Polymer:<pre class="prettyprint">&lt;polymer-element name="hello-you"><br />  &lt;template><br />    &lt;div><br /><b>      &lt;h2>{{hello}} {{your_name}}&lt;/h2><br />      &lt;p><br />        &lt;input value="{{your_name}}"><br />        &lt;input type=submit value="{{done}}!" on-click="{{feelingLucky}}"><br />      &lt;/p><br />      &lt;p class=instructions><br />        {{instructions}}<br />      &lt;/p></b><br />    &lt;/div><br />  &lt;/template><br />  &lt;script type="application/dart" src="hello_you.dart">&lt;/script><br />&lt;/polymer-element></pre>So where do those composite message classes come into play? In the spirit of forest / trees, I am going to look at two trees really close and move on from there.<br /><br />The two trees in questions are <code>Intl.message()</code> and <code>Intl.plural()</code>. The latter lets me return different messages based on a number supplied. In my case, I will supply the count from the Polymer. The other tree, er… method “returns a message that can be internationalized.” Using the count from the Polymer, I return the number of red balloons in my possession, in French:<br /><pre class="prettyprint"><code><br />  // ...<br />  static Map get fr => {<br />    'hello': 'Bonjour',<br />    'done': 'Fin',<br />    'how_many': 'Combien?',<br />    'instructions': 'Présentez-vous une expérience personnalisée incroyable!',<br />    'count_message': (count) =><br />      Intl.message(<br />      '''${Intl.plural(count,<br />             zero: "Je n'ai pas de ballons rouge",<br />             one: "J'ai un ballon rouge",<br />             other: "J'ai $count ballons rouge")}.''')<br />  };<br />  // ...</code></pre>And that more or less does the trick. I can bind a button to an <code>updateCount()</code> method:<pre class="prettyprint">&lt;polymer-element name="hello-you"><br />  &lt;template><br />      &lt;!-- ... --><br />      &lt;p><br />        {{how_many}}<br />        &lt;input value="{{count}}"><br /><b>        &lt;input type=submit value="{{done}}!" on-click="{{updateCount}}"></b><br />      &lt;/p><br />      &lt;p><br />        {{count_message}}<br />      &lt;/p><br />      &lt;!-- ... --><br />  &lt;script type="application/dart" src="hello_you.dart">&lt;/script><br />&lt;/polymer-element></pre>And my backing method can update the <code>count_message</code> string:<pre class="prettyprint">@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  // ...<br />  @observable int count;<br />  @observable String count_message;<br />  // ...<br /><b>  updateCount() {<br />    count_message = _labels['count_message'](int.parse(count));<br />  }</b><br />}</pre>The result is that I can have 99 red balloons in French:<br /><br /><a href="http://1.bp.blogspot.com/-G4JsbG2BvAQ/UrkW5Im6XWI/AAAAAAAAUmc/sMTOILO8Ro4/s1600/01-99_french_balloon.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-G4JsbG2BvAQ/UrkW5Im6XWI/AAAAAAAAUmc/sMTOILO8Ro4/s640/01-99_french_balloon.png" /></a><br /><br />And I can have 99 English balloons:<br /><br /><a href="http://1.bp.blogspot.com/-kk580ZGk6D4/UrkXlV-KIuI/AAAAAAAAUmk/Wss4CwGSPdE/s1600/02-99_english_balloons.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-kk580ZGk6D4/UrkXlV-KIuI/AAAAAAAAUmk/Wss4CwGSPdE/s640/02-99_english_balloons.png" /></a><br /><br />In order to get the latter, I need to duplicate the <code>Intl.message()</code> in English:<pre class="prettyprint">// ...<br />  static Map get en => {<br />    // ...<br />    'count_message': (count) =><br /><b>      Intl.message(<br />      '''${Intl.plural(count,<br />             zero: "I have no red balloons",<br />             one: "I have one red balloon",<br />             other: "I have $count red balloons")}.''')</b><br />  };<br />  // ...</pre>I <i>think</i> that is proper use of <code>Intl.plural</code>, but I have not quite got <code>Intl.message()</code> right. Ultimately, I would like to either be able to set the default locale of my Polymer at runtime to choose the correct version of a “count message” function. My current approach kinda / sorta does that, but there is an actual <code>Intl.defaultLocale</code> property that I am currently not using at all. <br /><br />In order to do so, I at least need to supply the <code>name</code> parameter to <code>Intl.message()</code>. I am still somewhat vague on how that fits into the grander scheme of <code>intl</code> and its locale lookups, but hopefully that will become clearer as I continue to explore. Tomorrow.<br /><br /><span style="color: #ccc">Day #974</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2013/12/a-slightly-better-i18n-polymer.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2013/12/code-generation-and-polymer-i18n.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
