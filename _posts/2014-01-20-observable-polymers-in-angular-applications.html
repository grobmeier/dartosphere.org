---
title: 'Observable Polymers in Angular Applications'
layout: post
tags:
    - angular
    - chain
    - dart
    - dartlang
    - polymer
category: japhr-by-chris-strom
published: '2014-01-20T23:59:00-05:00'

---

<div class=top-chain-links></div><br />It seems that I may have been a tad premature in thinking that I had the <a href="http://dartlang.org">Dart</a> versions of <a href="http://angularjs.org/">Angular</a> and <a href="http://www.polymer-project.org/">Polymer</a> working together. To be sure, most of it is working. The Angular routing it successfully navigating between a simple start page and the page that contains my Polymer. The Polymer is sufficiently registered that it shows up on that second page:<br /><br /><a href="http://3.bp.blogspot.com/-EBAeHYfUOfU/Ut3Xrqv4guI/AAAAAAAAU4Y/hOiI8JK9Pkw/s1600/02-custom_angulage_page.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-EBAeHYfUOfU/Ut3Xrqv4guI/AAAAAAAAU4Y/hOiI8JK9Pkw/s640/02-custom_angulage_page.png" /></a><br /><br />But that turns out to be the extent of it. Even though the Polymer is starting enough to display, none of its buttons and menus are doing what they are supposed to be doing: building a pizza. At first I suspected that Angular was somehome seizing control of the various template bindings. The answer turns out to be much more mundane.<br /><br />For whatever reason, I continue to use two Polymer lifecycle methods, <code>ready()</code> and <code>enteredView()</code>, interchangeably. They are not interchangeable—the developers would not bothered to create them if they were. And, in fact, this seems to be the use case in which they distinguish themselves. When I normally develop a Polymer, it is the only thing on the page. The Polymer is “ready” in this case when the Polymer has entered the view.<br /><br />In my Angular application, however, the Polymer is ready when it and the Angular code load on the first page. By the time the next Angular route is accessed, the Polymer has been ready, left the view (resulting in observers going away), and brought back without re-registering things. Happily, the solution is to use the correct lifecycle method:<pre class="prettyprint">@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  XPizza.created(): super.created();<br /><b>  enteredView() {<br />    super.enteredView();</b><br />    model = new Pizza()<br />      ..changes.listen(updatePizzaState);<br /><br />    updatePizzaState();<br />  }<br />  // ...<br />}</pre>That gets me a little closer, but things are still not updating when I make changes to the underlying model in the Polymer. I suspect that this is yet another case of <code>Observable</code> not <a href="https://code.google.com/p/dart/issues/detail?id=15512">updating in raw Dart</a>. When I work with plain old Polymer, I work around this problem with a <a href="http://pub.dartlang.org/">Dart Pub</a> transformer. <br /><br />When I got started with this Angular and Polymer combination, I purposefully removed the transformer to reduce the number of moving parts. In an attempt to get Observables working again, I restore the transformer in <code>pubspec.yaml</code>:<pre class=prettyprint>name: angular_example<br />dependencies:<br />  angular: any<br />  polymer: any<br />dev_dependencies:<br />  unittest: any<br /><b>transformers:<br />- polymer:<br />    entry_points: web/index.html</b></pre>Now, when I start up <code>pub serve</code>, I get loads of errors:<pre class=prettyprint>➜  dart git:(master) ✗ pub serve<br />Serving angular_example on http://localhost:8080<br />[Warning from polymer (Linter) on angular_example|web/partials/custom.html]:<br />web/partials/custom.html:4:3: definition for Polymer element with tag name "x-pizza" not found.<br />[Warning from polymer (Linter) on angular_example|web/index.html]:<br />web/index.html:22:7: definition for Polymer element with tag name "ng-view" not found.<br />...</pre>There are a bunch more, but I eventually realize that those are just the usual <code>dart2js</code> warnings and errors. Hopefully those are just what they seem—linter warnings that do not have any real bearing.<br /><br />But when I load my Angular application, I receive a very worrisome error:<pre class=prettyprint>Exception: InvalidStateError: An attempt was made to use an object that is not, or is no longer, usable. (Dartium)</pre>Worrisome, but apparently not devastating: the application, including observable (and buildable) <code>&lt;x-pizza></code> elements, now works:<br /><br /><a href="http://3.bp.blogspot.com/-j0dA0GxH8uI/Ut3u4Bb-ziI/AAAAAAAAU4o/G01ZUHNzNSg/s1600/02-observable_angular_polymer.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-j0dA0GxH8uI/Ut3u4Bb-ziI/AAAAAAAAU4o/G01ZUHNzNSg/s640/02-observable_angular_polymer.png" /></a><br /><br />That is not quite the end of it as this does not appear to work when compiled to JavaScript, but I leave that puzzle for another day.<br /><br /><br /><br /><span style="color: #ccc">Day #1,002</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/day-1001-getting-started-with-angular.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/dynamically-binding-polymer-values-into.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
