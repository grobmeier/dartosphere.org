---
title: 'Holy Cow, Dart Unit Tests are Easy'
layout: post
tags:
    - dart
    - dartlang
category: seth-ladds-blog
published: '2013-01-28T22:38:00-08:00'

---

<div class="separator" style="clear: both; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-kHsWvzaUbpM/UQdmASQtEzI/AAAAAAAAPBk/62ErwVsGb_w/s1600/Screenshot_1_28_13_10_01_PM.png" /></div><br /><br />Dart provides a rich <a href="http://www.dartlang.org/articles/dart-unit-tests/">unit test library</a> out of the box. Inspired by testing libraries like <a href="http://http//code.google.com/p/hamcrest/">Hamcrest</a> and <a href="https://github.com/Ladicek/darmatch">dartmatch</a>, the <a href="http://api.dartlang.org/docs/bleeding_edge/unittest.html">dart:unittest library</a> provides test groups, numerous matchers, and more. Read on to learn how easy it is to write your first Dart unit tests!<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><img border="0" height="456" src="http://2.bp.blogspot.com/-AzbZOLpHp5Q/UQdfP6bXxVI/AAAAAAAAPA8/ClEqNIxqHrk/s640/Screen+Shot+2013-01-28+at+9.33.56+PM.png" style="margin-left: auto; margin-right: auto;" width="640" /></td></tr><tr><td class="tr-caption" style="text-align: center;">You, too, can create tests this pretty.</td></tr></tbody></table><br /><span style="font-size: large;">Test subject</span><br /><br />To illustrate, I've just created the soon-to-be massively critical embiggen library. This library will bigify your text. It's very advanced.<br /><br />Of course, I made a <a href="http://pub.dartlang.org/">pub</a> package for this library:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-C3P9LhEX9OU/UQdhK8EPVAI/AAAAAAAAPBU/NaVUpGGRqfs/s1600/Screen+Shot+2013-01-28+at+9.39.50+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-C3P9LhEX9OU/UQdhK8EPVAI/AAAAAAAAPBU/NaVUpGGRqfs/s1600/Screen+Shot+2013-01-28+at+9.39.50+PM.png" /></a></div><br />The contents of embiggen.dart are:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> library embiggen;  <br />   <br /> String embiggen(String msg) {  <br />  if (msg == null) {  <br />   throw new ArgumentError("must not be null");  <br />  }  <br />    <br />  return msg.toUpperCase();  <br /> }  <br /></code></pre><br />I'll let that sink in for a while, it's pretty intense.<br /><br /><span style="font-size: large;">Add the unit test package</span><br /><br />You can use pub to get the unit test package and link it into your project. Simply declare the unittest dependency in your pubspec.yaml:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> name: embiggen  <br /> description: Turns small things into big things.  <br />   <br /> dependencies:  <br />  unittest: any  <br /></code></pre><br />Dart Editor will automatically run "pub install" when it detects a change to pubspec.yaml. If you are using the command-line tools, you can run "pub install" manually. This step will find the unittest package in your local pub cache, or it will download it from pub.dartlang.org. Once found, pub will set up the proper symlinks to make unittest available to your project.<br /><br /><span style="font-size: large;">Set up the tests</span><br /><br />The <a href="http://pub.dartlang.org/doc/package-layout.html">pub package layout convention</a> dictates that tests should be placed inside a "test" directory. Create a new file named "embiggen_test.dart" and place it inside "test".<br /><br />Import both the embiggen library and the unittest library. You need to import embiggen because your test needs to access the actual embiggen function.<br /><br />Here is embiggen_test.dart so far:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> library embiggen_test;  <br />   <br /> import 'package:embiggen/embiggen.dart';  <br /> import 'package:unittest/unittest.dart';  <br />   <br /></code></pre><br />(Note: you may need to run "pub install" again, which will configure symlinks in your "test" directory.)<br /><br /><span style="font-size: large;">Write a test</span><br /><br />Dart is a language without much ceremony, so let's dive into it. Create a main() function and place the first test inside. A test takes a name (or, a very short description) and an anonymous function that itself contains the test condition.<br /><br />Here is embiggen_test.dart with a simple test:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> library embiggen_test;  <br />   <br /> import 'package:embiggen/embiggen.dart';  <br /> import 'package:unittest/unittest.dart';  <br />   <br /> main() {  <br />  test("bigifies text", () {  <br />   expect(embiggen("hello"), equals("HELLO"));  <br />  });  <br /> }  <br /></code></pre><br />Use "expect(actualValue, expectedValueMatcher)" to perform the actual test. The "expectedValueMatcher" is dynamic, it can be a simple value or a matcher that can test for a wide variety of values. In the above example, equals("HELLO") returns a simple matcher that matches on equality. More on matchers shortly.<br /><br /><span style="font-size: large;">Run the test</span><br /><br />Choosing to place the tests inside main() was deliberate, it enables the Dart file to act as its own test runner. Simply run the embiggen_test.dart file, either from the command line or via Dart Editor.<br /><br />Here is the output on the console:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> unittest-suite-wait-for-done  <br /> PASS: bigifies text  <br />   <br /> All 1 tests passed.  <br /> unittest-suite-success  <br /></code></pre><br />Out of the box formatting!<br /><br />A failed test looks like this:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> unittest-suite-wait-for-done  <br /> FAIL: bigifies text  <br />  Expected: 'HELL'  <br />     but: was 'HELLO'.  <br />    <br />  #0   DefaultFailureHandler.fail (package:unittest/src/expect.dart:86:5)  <br />  #1   DefaultFailureHandler.failMatch (package:unittest/src/expect.dart:90:9)  <br />  #2   expect (package:unittest/src/expect.dart:55:29)  <br />  #3   main.&lt;anonymous closure&gt; (file:///Users/sethladd/dart/embiggen/test/embiggen_test.dart:8:11)  <br />  #4   TestCase.run (package:unittest/src/test_case.dart:83:11)  <br />  #5   _nextBatch._nextBatch.&lt;anonymous closure&gt; (package:unittest/unittest.dart:808:19)  <br />  #6   guardAsync (package:unittest/unittest.dart:767:19)  <br />    <br />   <br /> 0 PASSED, 1 FAILED, 0 ERRORS  <br />   <br /></code></pre><br /><span style="font-size: large;">Test for exception</span><br /><br />Passing null to embiggen() will throw an ArgumentError, so let's not forget to test for the error condition. First, be sure to wrap the condition to test inside an anonymous function. This ensures that any exceptions thrown by the condition are properly caught. There are plenty of pre-built matchers to help with exceptions, from the simple "throws", which tests that anything was thrown, to specific matchers like "throwsArgumentError".<br /><br />Here is embiggen_test.dart with a test for an exception:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> library embiggen_test;  <br />   <br /> import 'package:embiggen/embiggen.dart';  <br /> import 'package:unittest/unittest.dart';  <br />   <br /> main() {  <br />  test("bigifies text", () {  <br />   expect(embiggen("hello"), equals("HELLO"));  <br />  });  <br />    <br />  <b>test("null throws ArgumentError", () {  <br />   expect(() =&gt; embiggen(null), throwsArgumentError);  <br />  });</b>  <br /> }  <br /></code></pre><br /><span style="font-size: large;">What's next</span><br /><br />This post barely scratches the surface. Dart's unit test library has support for setup/teardown, test groups, nested groups, a very extensive <a href="http://api.dartlang.org/docs/bleeding_edge/matcher.html">matchers library</a>, and even mocks/stubs. Dart also has various test outputs, ranging from VM to HTML (which you can see an example of in the top of this post).<br /><br /><span style="font-size: large;">Further reading</span><br /><br /><ul><li><a href="http://www.dartlang.org/articles/dart-unit-tests/">Unit testing with Dart</a>&nbsp;article</li><li><a href="http://shailen.github.com/blog/2012/11/19/writing-unit-tests-for-pub-packages/">Writing unit tests for pub packages in Dart</a> blog post</li><li><a href="http://dartcasts.com/post/41752021557/episode-9-unit-testing-part-1-the-first">Unit test, Part 1</a> screencast</li></ul><br /><span style="font-size: large;">Summary</span><br /><br />Unit tests come out of the box with the Dart SDK. They are simple to write, compose well, and have many matchers. Simply create a "test" directory, add Dart test scripts, and BOOM you're making ice cream.<br /><br /><span style="font-size: xx-small;">(Nerd cow credit:&nbsp;<a href="http://www.flickr.com/photos/toastersarts/6893702709/">http://www.flickr.com/photos/toastersarts/6893702709/</a>)</span><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/GKyM-0hmCD4" height="1" width="1"/>
