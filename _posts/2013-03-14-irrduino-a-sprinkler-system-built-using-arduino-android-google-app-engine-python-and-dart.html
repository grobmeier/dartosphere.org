---
title: 'Irrduino: A Sprinkler System Built Using Arduino, Android, Google App Engine, Python, and Dart'
layout: post
tags:
    - android
    - arduino
    - dartlang
    - 'Google App Engine'
    - python
category: jjinuxland
published: '2013-03-14T11:08:00-07:00'

---

<div dir="ltr" style="text-align: left;" trbidi="on"><i>Cross-posted from <a href="http://news.dartlang.org/2013/03/irrduino-sprinkler-system-built-using.html">Dart News &amp; Updates</a></i>. <br /><br /><a href="http://2.bp.blogspot.com/-RfJ9ONyUq-Y/UUH7KZ7ExqI/AAAAAAAABu8/jEGTdjkal34/s1600/Screen+Shot+2013-03-14+at+9.29.37+AM.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-RfJ9ONyUq-Y/UUH7KZ7ExqI/AAAAAAAABu8/jEGTdjkal34/s320/Screen+Shot+2013-03-14+at+9.29.37+AM.png" /></a><br /><br />Developers frequently ask me if Dart is ready for the real world. Well, of course, that depends on the application. Check out this <a href="http://www.youtube.com/watch?v=YQrEEfltWFE">short video</a> in which Joe Fernandez and I not only show that Dart can be used in the real world, we also show that it can be used to take the tedium out of watering your lawn! <br /><br /><iframe width="560" height="315" src="http://www.youtube.com/embed/YQrEEfltWFE" frameborder="0" allowfullscreen></iframe><br /><br />The Dart code for Lawnville was originally written in January of 2012, a mere three months after Dart was launched as a "technology preview". That was six months before Dart's M1 release, so it's been updated a few times along the way. However, the code really hasn't fundamentally changed that much since the beginning. <br /><br />Perhaps the most interesting piece of code is the use of a Queue (from the <code>dart:collection</code> library) to schedule watering tasks. You can click on different parts of the lawn, and the droid will fly over and water each section for a short amount of time: <pre><br />  _actionQueue = new Queue();<br />  ...<br />  _actionQueue.add({'action': 'water', 'zone': el.id});<br />  ...<br />  void _executeActionQueue() {<br />    if (_actionQueue.isEmpty) {<br />      _waitingForTimer = false;<br />      _idle();<br />    } else {<br />      var action = _actionQueue.removeFirst();<br />      _doAction(action);<br />      _waitingForTimer = true;<br />      new Timer(new Duration(milliseconds: TIMER_INTERVAL),<br />                _executeActionQueue);<br />    }<br />  }<br /></pre>A <code>Timer</code> and <code>window.requestAnimationFrame</code> are used to control animations: <pre><br />  void _repositionDroid(int x, int y, [Callback callback = null]) {<br />    x -= (HALF * DROID_WIDTH).toInt();<br />    y -= DROID_HEIGHT;<br />    _droid.src = "/static/images/droid-jetpack-on-front.png";<br />    _droid.style.left = "${x}px";<br />    _droid.style.top = "${y}px";<br />    new Timer(new Duration(milliseconds: REPOSITION_DURATION), () {<br />      if (callback != null) {<br />        callback();<br />      } else {<br />        _droid.src = "/static/images/droid-waiting-front.png";<br />      }<br />    });<br />  }<br /><br />  void _startAnimationLoop() {<br />    _animationStartTime = new DateTime.now().millisecondsSinceEpoch;<br />    window.requestAnimationFrame(_animationLoop);<br />  }<br /><br />  void _animationLoop(int timestamp) {<br />    _animationProgress = timestamp - _animationStartTime;<br />    for (Callback callback in _animationCallbacks.values) {<br />      callback();<br />    }<br />    window.requestAnimationFrame(_animationLoop);<br />  }<br /></pre>An <code>HttpRequest</code> is used to send commands to IrrduinoServer which in turn sends commands to IrrduinoController in order to control the sprinkler system: <pre><br />  void _waterRpc(int zone) {<br />    var req = new HttpRequest();<br />    int secs = (TIMER_INTERVAL * SECS_PER_MS).toInt();<br />    req.open("POST", "/?water-zone=true&zone=${zone}&secs=${secs}", true);<br />    req.onReadyStateChange.listen((Event e) {<br />      if (req.readyState == 4) {<br />        if (req.status == 200) {<br />          window.console.log("Watering was successful");<br />        } else {<br />          window.console.log("Watering was unsuccessful");<br />        }<br />      }<br />    });<br />    req.send();<br />  }<br /></pre>In total, the complete Dart code is about 110 lines long, not counting comments and closing braces. <br /><br />You might wonder why I chose to use Dart so soon after its release, especially since I wasn't even on the Dart team at the time. I've always gotten a kick out of coding in new languages. At the time, I figured that as long as I could talk to the DOM and make XMLHttpRequests, I could do almost anything. These days, Dart is a lot more useful thanks to the growing selection of pub packages available, but even before these things existed, Dart had enough functionality to help water a lawn ;) <br /><br />If you want to download the complete source code for Irrduino, you can get it from <a href="http://bit.ly/waterjoeslawn">bit.ly/waterjoeslawn</a>. <br /></div>
