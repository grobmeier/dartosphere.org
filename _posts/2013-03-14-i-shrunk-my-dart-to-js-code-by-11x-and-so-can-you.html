---
title: 'I Shrunk my Dart-to-JS code by 11X and So Can You'
layout: post
tags:
    - dart
    - dartlang
category: seth-ladds-blog
published: '2013-03-14T13:20:00-07:00'

---

<a href="http://www.dartlang.org/" target="_blank">Dart</a>, the structured and scalable programming language for web apps, compiles to JavaScript thanks to <a href="http://www.dartlang.org/docs/dart2js/" target="_blank">dart2js</a>. This means Dart apps run across the modern web. When you compile to JavaScript, you want to ensure dart2js generates the smallest amount of bytes. Less bytes means smaller bandwidth bills, and faster load times, and longer battery life. All good things! Read on to learn how to minify your generated JavaScript.<br /><br />For this example, I will use the <a href="https://github.com/sethladd/lawndart/tree/master/example/todo" target="_blank">offline-enabled Todo app</a> that I built to highlight <a href="https://github.com/sethladd/lawndart" target="_blank">Lawndart</a>, my easy library for browser storage. The Todo app uses quite a few libraries:<br /><ul><li>dart:html</li><li>Lawndart</li><li>WebSQL</li><li>IndexedDB</li><li>Local storage</li><li>Web UI</li></ul>The original generated JavaScript output size was 612,249 bytes. Minified, it became 289,840 bytes. Minified and gzipped it became 56,496 bytes. <b>That's about 11X smaller than the original output!</b><br /><br />(Measuring the original size of the code is tricky. Do I count the lines that I wrote? Do I count the lines generated by the Web UI compiler? I count 9,313 bytes of generated Dart code from the Web UI compiler, which is the code that would be shipped down to Dartium during development. This does <b>not</b>&nbsp;count the size of the packages required. Also, most developers would run a tree-shaking tool on the Dart code if they want to ship pure Dart in production. When I ran dart2dart to generate a single file that contained all the Dart code required for the app, I ended up with&nbsp;44,860 bytes unminified and ungzipped.)<br /><br />Let's learn how to get compiled JavaScript output as small as possible.<br /><br /><span style="font-size: large;">Step One: Turn on Minification</span><br /><br />The editor does not ship with minification turned on by default. Say what?! Fear not, we can fix that.<br /><br /><ol><li>Right click on your project</li><li>Select properties</li><li>Select Dart Settings</li><li>Add --minify to "Additional flags:"</li><li>Embrace the smallification</li></ol><div>See this in action:</div><br /><iframe allowfullscreen="" frameborder="0" height="480" src="http://www.youtube.com/embed/ndOycltKKbs" width="640"></iframe> <br /><br />(Here's a <a href="https://code.google.com/p/dart/issues/detail?id=8751" target="_blank">bug</a> that requests to make this easier, please star!)<br /><br />If you don't use Dart Editor, you can also minify from the command line. Here is an example:<br /><br /><span style="font-family: Courier New, Courier, monospace;">dart2js --minify --out=app.js app.dart</span><br /><br />The file shrinks to&nbsp;289,840 bytes with minification, a 2.1X shrinkage!<br /><br /><span style="font-size: large;">Step Two: Compress the file on-the-fly</span><br /><br />Most web servers will compress your files for you, on the fly! See your web server's configuration for more details.<br /><br /><ul><li><a href="http://httpd.apache.org/docs/2.2/mod/mod_deflate.html" target="_blank">Adding gzip to Apache</a></li><li><a href="http://wiki.nginx.org/HttpGzipModule" target="_blank">Adding gzip to nginx</a></li><li><a href="https://developers.google.com/appengine/kb/general#compression" target="_blank">Adding gzip to App Engine</a></li></ul><div>The file shrinks to&nbsp;56,496 bytes with gzip, a 11X shrinkage from the original!</div><div><br /></div><div><span style="font-size: large;">Step Three: There is no step three!</span></div><div><br /></div><div>Yup, just use <span style="font-family: Courier New, Courier, monospace;">--minify</span> with dart2js and be sure your server has turned on compression/gzip.</div><div><br /></div><div>To be sure, we're not yet happy with the output size and we're working hard to generate even smaller code. However, minification really helps and you should use it today. Please file bugs and feature requires at <a href="http://dartbug.com/">dartbug.com</a>. Thanks!</div><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/An264B-I-q8" height="1" width="1"/>
