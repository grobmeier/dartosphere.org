---
title: 'Day 999: Polymer and SVG'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg
category: japhr-by-chris-strom
published: '2014-01-17T23:58:00-05:00'

---

<div class=top-chain-links></div><br />I can't resist. The temptation to play around with SVG is simply too great and I am helpless before its wiles.<br />I really meant to start looking at incorporating <a href="http://www.polymer-project.org/">Polymer</a> elements in <a href="http://angularjs.org/">Angular</a>. Perhaps tomorrow. Onto the SVG!<br /><br />I have a pretty cool <code>&lt;x-pizza></code> Polymer that builds pizzas for ordering:<br /><br /><a href="http://1.bp.blogspot.com/-H-YVHqw_-vE/UtnlQrZ07HI/AAAAAAAAU2c/wm5EDWFDxW8/s1600/01-update_pizza_state.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-H-YVHqw_-vE/UtnlQrZ07HI/AAAAAAAAU2c/wm5EDWFDxW8/s640/01-update_pizza_state.png" /></a><br /><br />The problem, of course, is that the current pizza state is in the form of text. Saaaay! SVG can help with that!<br /><br />I start by adding a blank SVG tag to my <code>&lt;x-pizza></code> template:<pre class=prettyprint>&lt;polymer-element name="x-pizza"><br />  &lt;template><br />    &lt;h2>Build Your Pizza&lt;/h2><br /><br />    &lt;!-- &lt;pre>{{pizzaState}}&lt;/pre> --><br />    &lt;div title="{{pizzaState}}"><br /><b>      &lt;svg version="1.1"<br />        baseProfile="full"<br />        id="pizza-graphic"<br />        style="display: block; margin: 10px auto"<br />        width="300" height="300"<br />        xmlns="http://www.w3.org/2000/svg"><br />      &lt;/svg></b><br />    &lt;/div><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script type="application/dart" src="x_pizza.dart">&lt;/script><br />&lt;/polymer-element><br /></pre>That creates a 300 by 300 blank SVG canvas on which to paint. I give it an ID so that I can readily look it up using the Polymer <code>$</code> for automatic node finding.<br /><br />I already have my Polymer updating the pizza state (text-only so far) when new items are selected from the various menus. To do so, the <code>updatePizzaState()</code> method is called by various change event handlers. I factor the old text-only code out into <code>_updatePizzaText()</code>. In addition to calling this method, I also have <code>updatePizzaState()</code> call my new, SVG powered <code>_updateGraphic()</code> method:<pre class="prettyprint">@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  updatePizzaState([_]) {<br />    _updateText();<br />    <b>_updateGraphic();</b><br />  }<br /><br /><b>  _updateGraphic() {<br />    this.$['pizza-graphic'].innerHtml = '''<br />      &lt;circle cx="150" cy="150" r="150" fill="tan" /><br />      &lt;circle cx="150" cy="150" r="140" fill="darkred" /><br />      &lt;circle cx="150" cy="150" r="135" fill="lightyellow" /><br />    ''';<br />  }</b><br />  // ...<br />}</pre>There is not too much to <code>_updateGraphic()</code> so far. It adds three circles in the center of the 300 by 300 SVG element, each slightly smaller than the previous, each representing a different layer of the pizza (crust, sauce, and cheese). I use the <code>$</code> node finder to ensure that I have the correct SVG element.<br /><br />With that, I have SVG!<br /><br /><a href="http://2.bp.blogspot.com/-HMgPypdD6NQ/UtnoPLv5XfI/AAAAAAAAU2o/pZFP5igtyJY/s1600/01-svg_plain_pizza.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-HMgPypdD6NQ/UtnoPLv5XfI/AAAAAAAAU2o/pZFP5igtyJY/s640/01-svg_plain_pizza.png" /></a><br /><br />To add toppings, I need a generator for each of the supported toppings:<pre class="prettyprint"><code>  _svgPepperoni() =><br />    new CircleElement()..attributes = {'r': '10', 'fill': 'red'};<br />  _svgSausage() =><br />    new CircleElement()..attributes = {'r': '3',  'fill': 'brown'};<br />  _svgGreenPepper() =><br />    new CircleElement()..attributes = {'r': '10', 'fill': 'green'};</code></pre>Next, I need a way to choose the appropriate SVG maker function given a string representing a topping:<pre class="prettyprint"><code>  _toppingMaker(String topping) {<br />    if (topping == 'pepperoni') return _svgPepperoni;<br />    if (topping == 'sausage') return _svgSausage;<br />    if (topping == 'green peppers') return _svgGreenPepper;<br />  }</code></pre>With that, I can iterate over each topping and add them to the pizza:<pre class=prettyprint><code>  _addWholeToppings() {<br />    model.wholeToppings.forEach((topping) {<br />      var maker = _toppingMaker(topping);<br />      _addWholeTopping(maker);<br />    });<br />  }</code></pre>The <code>maker</code> now points to the appropriate generator function (e.g. _svgPepperoni). Armed with that, I can make 20 randomly placed toppings with:<pre class="prettyprint"><code>  _addWholeTopping(maker) {<br />    var rand = new Random();<br />    for (var i=0; i&lt;20; i++) {<br />      var topping = maker();<br />      topping.attributes<br />        ..['cx'] = "${150 + (90 * cos(PI * rand.nextDouble()))}"<br />        ..['cy'] = "${150 + (90 * cos(PI * rand.nextDouble()))}";<br />      $['pizza-graphic'].append(topping);<br />    }<br />  }</code></pre>And that does the trick. The end result is:<br /><br /><a href="http://2.bp.blogspot.com/-vIs_Bj9rLpE/UtoK4LYkRrI/AAAAAAAAU24/ZeHctNgICcQ/s1600/02-with_toppings.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-vIs_Bj9rLpE/UtoK4LYkRrI/AAAAAAAAU24/ZeHctNgICcQ/s640/02-with_toppings.png" /></a><br /><br />So yeah, I need a better green pepper. And maybe some animation. And random placement probably isn't quite right. But it is definitely better than plain text. So, yay SVG!<br /><br /><br /><span style="color: #ccc">Day #999</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/day-998-binding-to-model-changes-in.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/day-1000-animated-svg-in-polymer.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
