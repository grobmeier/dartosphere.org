---
title: 'Compile-time dead code elimination with dart2js'
layout: post
tags:
    - dart
    - dartlang
category: seth-ladds-blog
published: '2013-12-11T00:10:00-08:00'

---

Right before the release of Dart 1.0, the Dart team snuck in a cool new feature that helps you optimize the generated JavaScript from your Dart apps. Configuration values from the environment can be evaluated at compile time and potentially result in dead code elimination. Smaller code is faster code!<br /><br />As an example, let's consider the common case of logging. Debug logging is a useful tool during development and testing, but often there's no need to ship production code with debug log statements. Wouldn't it be cool if you could remove all the debug log statements before you ship to production, without having to manually delete any lines of code? Now with Dart and <i>fromEnvironment</i>, you can!<br /><br />Here is a small example of a log function that is useful during development, but unnecessary during production. If a DEBUG is set, the log message is printed. The code gets the compile-time constant value from the&nbsp;<i>String.fromEnvironment() constructor</i>. Notice the <i>const</i>&nbsp;qualifier, instead of <i>new</i>, as the important signal that the environment value is a <i>compile-time constant</i>. Without <i>const</i>&nbsp;here, the compiler doesn't know what the value is during compilation.<br /><br /><pre class="prettyprint">log(String msg) {<br />  if (const String.fromEnvironment('DEBUG') != null) {<br />    print('debug: $msg');<br />  }<br />}<br /><br />main() {<br />  log('In production, I do not exist');<br />}<br /></pre><br />For dart2js, you can pass values from the environment (not to be confused with "environment variables" that you might set in your shell) via the&nbsp;<span style="font-family: Courier New, Courier, monospace;">-D</span> command line arguments.<br /><br />When compiled with&nbsp;<span style="font-family: Courier New, Courier, monospace;">dart2js -DDEBUG=true app.dart</span>, the output includes the logging behavior:<br /><br /><pre class="prettyprint">  main: function() {<br />    H.printString("debug: In the production release, I do not exist");<br />  }<br /></pre><br />Notice how dart2js inlined the log function into main, which is cool. Because the DEBUG value was set, dart2js knew that the <span style="font-family: Courier New, Courier, monospace;">if</span> statement inside of <span style="font-family: Courier New, Courier, monospace;">log()</span> returns true.<br /><br />However, if -DDEBUG is not set, the logging behavior is not included in the generated JavaScript code:<br /><br /><pre class="prettyprint">  main: function() {<br />  }<br /></pre><br />Tools like dart2js can understand how expressions that use compile-time constants resolve. Dead code is eliminated from the generated output.<br /><br />Strings, ints, and booleans can produce values from the environment: <a href="https://api.dartlang.org/docs/channels/stable/latest/dart_core/int.html#fromEnvironment">int.fromEnvironment</a>, <a href="https://api.dartlang.org/docs/channels/stable/latest/dart_core/String.html#fromEnvironment">String.fromEnvironment</a>, and&nbsp;<a href="https://api.dartlang.org/docs/channels/stable/latest/dart_core/bool.html#fromEnvironment">bool.fromEnvironment</a>. Use <i>fromEnvironment</i>&nbsp;with <i>const</i>&nbsp;to help control which code blocks make it into the generated JavaScript code.<img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/30u2zFZ8Xpk" height="1" width="1"/>
