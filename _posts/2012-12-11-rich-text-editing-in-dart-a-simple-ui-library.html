---
title: 'Rich Text Editing in Dart - a simple UI library'
layout: post
tags:
    - article
category: dartwatch
published: '2012-12-11T23:58:00+00:00'

---

<br />
<h1>
Creating a rich text editor in Dart.</h1>
I had an hour or so to kill on a flight today, so I decided to see how hard 
it would be to create a simple rich text editor with Dart. Many of the 
JavaScript frameworks use an iframe, however, cross iframe communication with 
Dart is more restrictive than with JavaScript (see <a href="http://code.google.com/p/dart/issues/detail?id=2846">dartbug 2846</a>), so 
a direct port of some of the simple JavaScript examples wasn't possible.<br />
<br />
Here is the final result, before you read the rest of the article (<a href="http://chrisbu.github.com/simple_text_editor/web/texteditor.html" target="_blank">hosted here</a>, <a href="https://github.com/chrisbu/simple_text_editor">src here</a>):<br />
<iframe src="http://chrisbu.github.com/simple_text_editor/web/texteditor.html" style="height: 460px; width: 550px;"></iframe>

<br />
<h2>
HTML5 to the rescue</h2>
Dart is designed to target modern browsers, and that means html5. The 
<code>contentEditable</code> property (<a href="https://developer.mozilla.org/en-US/docs/HTML/Content_Editable">see docs 
on MDN</a>) can be set to true, to make a div editable. (You can also check the 
current state of an element by checking the value of 
<code>isContentEditable</code> <br />
For example, the following markup:<br />
<pre><code>&lt;div contentEditable="true"&gt;You can edit me&lt;/div&gt;
</code></pre>
will let you type directly into the "editme" div.<br />
<em>Try it:</em><br />
<div style="border-bottom: black 1px solid; border-left: black 1px solid; border-right: black 1px solid; border-top: black 1px solid; margin-left: 10px; margin-right: 10px;" contentEditable="true">
You can edit me</div>
<br />
You also get any formatting of the innerHTML of the div, such as:<br />
<pre><code>&lt;div contentEditable="true"&gt;&lt;b&gt;You can&lt;/b&gt;&lt;i&gt;edit me&lt;/i&gt;&lt;/div&gt;
</code></pre>
which allows you to edit the content inclusive of formatting.<br />
<em>Try it:</em><br />
<div style="border-bottom: black 1px solid; border-left: black 1px solid; border-right: black 1px solid; border-top: black 1px solid; margin-left: 10px; margin-right: 10px;" contentEditable="true">
<b>You can</b> <i>edit me</i></div>
<br />
Unfortunately, you are kind of stuck with the formatting that is already 
specified. I say "kind of" because if you use standard keyboard shortcuts, the 
formatting will change (for example, select the "You can edit me" text, and 
press Ctrl+B (or whatever your mac equivalent is). This is fine as long as you 
know the shortcuts, but if you don't, you're stuck. <br />
<h2>
Changing the formatting</h2>
What we need is a way to change the formatting programmatically, such as when 
the user clicks a "Bold" button, the selection will change to 
<strong>bold</strong>. We can do this with a browser DOM function 
<code>document.execCommand()</code> whose signature looks like this:<br />
<br />
<pre><code>bool execCommand(String command, bool userInterface, String value)
</code></pre>
<br />
We are only interested in the <code>command</code> parameter at this point. 
Valid command values include <code>bold</code>, <code>italic</code>, 
<code>underline</code>, <code>justifyleft</code> and <code>justifyright</code> 
(<a href="https://developer.mozilla.org/en-US/docs/Rich-Text_Editing_in_Mozilla#Executing_Commands">see 
here for more on MDN</a>). These commands perform the same function as the 
keyboard shortcuts; they modify the selected text appropriately. The 
<code>value</code> parameter is used for some of the the commants that expect a 
parameter, such as when setting a font, or inserting a URL. <br />
<h2>
Using execCommand</h2>
When <code>contentEditable</code> is set to <code>true</code>, the editable 
element gets its own <code>document</code> object that you can use to call 
execCommand against. For example, the following div:<br />
<br />
<pre><code>&lt;div id="editme"&gt;&lt;/div&gt;
</code></pre>
<br />
can be set editable and allow you to start editing in a <strong>bold</strong> 
font with the following dart snippet:<br />
<br />
<pre><code>var el = query("#editme");
el.contentEditable = "true";
el.document.execCommand("bold",true,""); // turn on bold font</code></pre>
<br />
Likewise, later changing back to normal weight font (ie, toggling bold off), 
the same command can be used:<br />
<br />
<pre><code>el.document.execCommand("bold",true,""); // turn bold font off again
</code></pre>
<br />
The content of the div contains the raw formatting, so if you want to access 
the raw text, you need to read the <code>innerHTML</code> property, such as:<br />
<br />
<pre><code>var textToSave = el.innerHTML;
</code></pre>
<br />
and inserting it is just a matter of setting the <code>innerHTML</code> 
property.<br />
<h2>
An example in action</h2>
The following screenshot shows a simple text editor that I've put together 
using the methods above. <br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="http://1.bp.blogspot.com/-uX5C-Wp_QOs/UMfH0a5sbBI/AAAAAAAACo4/j-cR0Hnq438/s1600/text+editor.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="370" src="http://1.bp.blogspot.com/-uX5C-Wp_QOs/UMfH0a5sbBI/AAAAAAAACo4/j-cR0Hnq438/s640/text+editor.png" width="640" /></a></div>
<br />
<br />
The <code>SimpleTextEditor</code> class is the core of the library, and the 
key pieces of code are where we use the execCommand function in button event 
handlers:<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;">
<pre style="line-height: 125%; margin: 0;">// font formatting
_toggleBold(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"bold"</span>,true,<span style="color: blue;">""</span>);
_toggleItalic(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"italic"</span>,true,<span style="color: blue;">""</span>);
_toggleUnderline(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"underline"</span>,true,<span style="color: blue;">""</span>);

// text justification  
_leftJustify(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"justifyleft"</span>,true,<span style="color: blue;">""</span>);
_centerJustify(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"justifycenter"</span>,true,<span style="color: blue;">""</span>);
_rightJustify(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"justifyright"</span>,true,<span style="color: blue;">""</span>);

// lists
_orderedList(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"insertorderedlist"</span>,true,<span style="color: blue;">""</span>);
_unorderedList(e) =&gt; _textbox.document.execCommand(<span style="color: blue;">"insertunorderedlist"</span>,true,<span style="color: blue;">""</span>);
</pre>
</div>
<a href="https://github.com/chrisbu/simple_text_editor">You can view the full 
source code on github</a><br />
<h2>
Using the editor in your own code</h2>
You can use this in your own code by adding the following pub dependency:<br />
<br />
<pre><code>dependencies: 
   simple_text_editor:
      git: git://github.com/chrisbu/simple_text_editor.git
</code></pre>
<br />
In your code, you can either initialize it at the time of construction, or 
attach it to a DOM element using the <code>attachTo(el)</code> method:<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;">
<pre style="line-height: 125%; margin: 0;">// use this style...
var st = new SimpleTextEditor(
    attachTo:query(<span style="color: blue;">"#container1"</span>),
    showRawText:true,
    text:<span style="color: blue;">"&lt;b&gt;Editor&lt;/b&gt; created with constructor"</span>);  

// <span style="font-weight: bold;">or</span> this style
var st1 = new SimpleTextEditor();
st1.showRawText = true;
st1.attach(query(<span style="color: blue;">"#container2"</span>));
st1.rawText = <span style="color: blue;">"&lt;b&gt;Editor&lt;/b&gt; created with properties and methods"</span>;
</pre>
</div>
<br />
This editor also contains an optional <code>TextArea</code> element to show 
the raw html. This updates as you type into the editable div (it also works in 
reverse).<br />
<br />
I've used the following CSS on my screenshot. You will need to specify your 
own widths and heights as appropriate for your scenario:<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;">
<pre style="line-height: 125%; margin: 0;">.texteditor {
  width: <span style="color: blue;">450</span>px;
  height: <span style="color: blue;">400</span>px;
  margin: <span style="color: blue;">3</span>px;
  padding: <span style="color: blue;">3</span>px; 
}

.rawtextarea {
  width: <span style="color: blue;">430</span>px;
  height: <span style="color: blue;">100</span>px;
  margin: <span style="color: blue;">3</span>px;
  padding: <span style="color: blue;">3</span>px;
}

.toolbar { }

.editbox {
  width: <span style="color: blue;">430</span>px;
  height: <span style="color: blue;">200</span>px;
  padding: <span style="color: blue;">3</span>px;
  margin: <span style="color: blue;">3</span>px;
  border: <span style="color: blue;">2</span>px solid black;  
}
</pre>
</div>
<h2>
Next Steps...</h2>
Well, the obvious next step is to turn it into a <a href="http://www.dartlang.org/articles/dart-web-components/"><strong>Web 
UI</strong></a> component. Perhaps I'll do that on the flight back.<div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/Dartwatch?a=x-E7dlqwmFw:q1uKGmEHf1A:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/Dartwatch?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/Dartwatch?a=x-E7dlqwmFw:q1uKGmEHf1A:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/Dartwatch?i=x-E7dlqwmFw:q1uKGmEHf1A:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/Dartwatch?a=x-E7dlqwmFw:q1uKGmEHf1A:qj6IDK7rITs"><img src="http://feeds.feedburner.com/~ff/Dartwatch?d=qj6IDK7rITs" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/Dartwatch?a=x-E7dlqwmFw:q1uKGmEHf1A:63t7Ie-LG7Y"><img src="http://feeds.feedburner.com/~ff/Dartwatch?d=63t7Ie-LG7Y" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/Dartwatch?a=x-E7dlqwmFw:q1uKGmEHf1A:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/Dartwatch?i=x-E7dlqwmFw:q1uKGmEHf1A:F7zBnMyn0Lo" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/Dartwatch/~4/x-E7dlqwmFw" height="1" width="1"/>
