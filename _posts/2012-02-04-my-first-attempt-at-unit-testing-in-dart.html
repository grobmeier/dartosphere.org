---
title: 'My First Attempt at Unit Testing in Dart'
layout: post
tags: {  }
category: dartery
published: '2012-02-04T16:14:00-08:00'

---

I have a small experimental Dart library I've been working on that I'd like to open source, but I don't have any documentation or great sample code. I don't want to let that stop me from releasing it while I scrape up some spare time to write docs and examples, and the library doesn't have tests, which is more of a problem.<br /><br />Sounds like a great time to learn how to do unit testing in Dart and document the library through the tests!<br /><br />Testing has <a href="https://groups.google.com/a/dartlang.org/forum/#!topic/misc/OtvntWROj3o" target="_blank">come up</a> on the <a href="https://groups.google.com/a/dartlang.org/forum/#!forum/misc" target="_blank">mailing list</a>&nbsp;recently, and I found out today that there's already a <a href="http://tdd-dart.blogspot.com/" target="_blank">blog dedicated to test-driven development in Dart</a> so it's a timely topic.&nbsp;All I knew going into this experiment was that there's some kind of unit testing library in <a href="http://code.google.com/p/dart/source/browse/#svn%2Ftrunk%2Fdart%2Fclient%2Ftesting%2Funittest" target="_blank">dart/client/testing</a> as <a href="https://plus.google.com/u/0/100798142896685420545/posts" target="_blank">Bob Nystrom</a>&nbsp;mentioned on the list, and I saw a small sample that Bob posted.<br /><br />A basic test looks like this:<br /><div class="syntax"><pre><span class="n">sayHello</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">'Hello </span><span class="si">$</span><span class="n">name</span><span class="s2">!'</span><span class="p">;</span><br /><br /><span class="n">main</span><span class="p">()</span> <span class="p">{</span><br />  <span class="n">test</span><span class="p">(</span><span class="s1">'Hello Test'</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span><br />    <span class="n">expect</span><span class="p">(</span><span class="n">sayHello</span><span class="p">(</span><span class="s1">'Justin'</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'Hello Justin!'</span><span class="p">;</span><br />  <span class="p">});</span><br /><span class="p">}</span><br /></pre></div>If you run the test (which I'll show later) you get this output:<br /><blockquote class="tr_bq"><pre>PASS: Hello Test<br /><br />All 1 tests passed.</pre></blockquote>Awesome, that's just what I want. It's simple, and I don't see any features like suites and there won't be decent mocking like EasyMock or Mockito until the Mirrors API arrives, but it'll work.<br /><br />There is some work to get it set up though. I have a recent version of the Dart editor and the SDK, but looking through them I didn't see the testing library. It seems that it's in the repo, but not included in the builds. So the first thing I do is check out trunk:<br /><blockquote class="tr_bq"><pre>svn checkout http://dart.googlecode.com/svn/trunk/ dart-read-only</pre></blockquote>&nbsp;This grabs more than I need, but that's fine.<br /><br />Next, I copy dart/client/testing into my project directory. I'm going to check in the unittest library for now so that it's easy for other people to clone the repo and run the tests without having to checkout the SDK.<br /><br />My project structure looks like this:<br /><ul><li>myProject/</li><ul><li>src/</li><li>tests/</li><li>third_party/</li><ul><li>testing/</li><ul><li>unittest/</li><ul><li>...</li></ul></ul></ul></ul></ul><div>Under tests/ I create my first test script, test.dart, and just to make sure that testing itself is working I write the simplest test I can:</div><div class="syntax"><pre>#<span class="k">library</span><span class="p">(</span><span class="s1">'tests'</span><span class="p">);</span><br /><br />#<span class="k">import</span><span class="p">(</span><span class="s1">'../third_party/testing/unittest/unittest_vm.dart'</span><span class="p">);</span><br /><br /><span class="n">main</span><span class="p">()</span> <span class="p">{</span><br />  <span class="n">test</span><span class="p">(</span><span class="s1">'Test Testing'</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span><br />    <span class="n">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span><span class="p">;</span><br />  <span class="p">});</span><br /><span class="p">}</span><br /></pre></div>I'm using unittest_vm.dart so that I can run my test from the command line:<br /><blockquote class="tr_bq"><pre>$DART_SDK/bin/dart tests/tests.dart</pre></blockquote>But I get an error:<br /><blockquote class="tr_bq"><pre>'third_party/testing/unittest/unittest_vm.dart': Error: line 19 pos 7: type 'Timer' is not loaded<br />  new Timer((timer) {<br />      ^</pre></blockquote>Oops, Timer has been moved from a builtin to the dart:io library. To fix this add the following line to unittest_vm.dart:<br /><div class="syntax"><pre>#<span class="k">import</span><span class="p">(</span><span class="s1">'dart:io'</span><span class="p">);</span><br /></pre></div>Now we can run the test and see that it passes.<br /><br />From here it's quite easy to import the library under test and write real tests. I haven't fully explored the features of the unittest library, but it's very small and the source is all there to inspect.<br /><br />It'll be interesting to see how the library ends up being packaged in a usable manner. There are still a lot of open questions around libraries that may affect how that's done.<br /><br />I'm still working on how to organize the tests in the absence of some kind of suite builder. The solution may be to write a test runner in Dart that scans the tests/ directory and runs every main() function it finds. I'm willing to bet there's already a script like that in the repo somewhere, but that's for another day and another post.
