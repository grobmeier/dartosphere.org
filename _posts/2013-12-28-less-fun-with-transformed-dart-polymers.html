---
title: 'Less Fun with Transformed Dart Polymers'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - i18n
    - polymer
category: japhr-by-chris-strom
published: '2013-12-28T23:59:00-05:00'

---

<div class=top-chain-links></div><br />Bleeding edge. Pre-alpha. Under rapid development. I love it all.<br /><br />Sure, it makes writing books hard, but seeing people smarter than me solve old problems in new ways or just solving new problems is fascinating. And, if something does not work, I usually just have to wait a couple of days before it gets fixed. For example, my <a href="http://japhr.blogspot.com/2013/12/wait-second-i-know-this.html">@observable problem</a> seems to have cleared up in recent <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> / observerable builds. Even more useful to my recent internationalization struggles, it seems that the Polymer transformer for <a href="http://pub.dartlang.org/">Dart Pub</a> has become slightly less hostile to <code>&lt;link></code> imports.<br /><br />I have been toying with using <code>&lt;link></code> imports to pull in <a href="http://www.polymer-project.org/">Polymer</a> configuration data. This works fairly well in both the JavaScript and <a href="http://dartlang.org">Dart</a> version of Polymer. But the Dart transformer that prepares an application for deployment has been silently deleting references to these imports:<pre class=prettyprint><code>    &lt;link rel="import" href="packages/i18n_example/hello-you.html"><br /><b>    &lt;link rel="import" href="packages/i18n_example/hello-you-en.json"><br />    &lt;link rel="import" href="packages/i18n_example/hello-you-fr.json"><br />    &lt;link rel="import" href="packages/i18n_example/hello-you-es.json"></b></code></pre>Any solution that I come up with is useless unless it can be deployed, so the silent deletion left me flummoxed. <br /><br />But after a recent <code>pub upgrade</code> to grab the latest package dependencies in my application, I noticed something odd with the transformed Polymers:<br /><br /><a href="http://3.bp.blogspot.com/-0SMDVs1E0qY/Ur-XOEd1fFI/AAAAAAAAUsg/3h_kdsKiBH0/s1600/01-link_import_residue.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-0SMDVs1E0qY/Ur-XOEd1fFI/AAAAAAAAUsg/3h_kdsKiBH0/s640/01-link_import_residue.png" /></a><br /><br />That seems workable. Sure, I might have style that data to <code>display: none</code> and I will have to conditionally check the DOM for that data directly embedded by the transform, but that seems a minor inconvenience. If it works. Which it does not.<br /><br />This will not work because, no matter where I place those <code>&lt;link></code> imports (in the document or in the Polymer template), the result is that the imported data is added directly to the document without structure. Even if I wrap the <code>&lt;link></code> tags in <code>&lt;div></code> tags, the result is the same—the transform adds the imported locale JSON directly to the document without structure:<pre class="prettyprint"><code>...<br />  &lt;body>{<br />  "hello": "Hello",<br />  "done": "Done",<br />  "how_many": "How many?",<br />  "instructions": "Introduce yourself for an amazing personalized experience!"<br />}<br />{<br />  "hello": "Bonjour",<br />  "done": "Fin",<br />  "how_many": "Combien?",<br />  "instructions": "Présentez-vous une expérience personnalisée incroyable!"<br />}<br />{<br />  "hello": "¡Hola!",<br />  "done": "Hecho",<br />  "how_many": "¿Cuántos?",<br />  "instructions": "Preséntese para una experiencia personalizada increíble!"<br />}<br />&lt;polymer-element name="hello-you"><br />...</code></pre>Bummer. I suppose from a transformer point of view, that makes sense. The transformer is converting the multi-filed application into something deployable. For Polymer, that means inserting the custom element declarations directly into the page. The transformer is not smart enough to know not to do so with JSON files and, even if it were “smart” enough, I am unsure how it ought to handle this case. Bundle them into the page in a way that somewhat mimics the <code>&lt;link></code> tag semantics? Ignore them and force these resources to continue to go through the “normal” <code>&lt;link></code> tag? The latter has its appeal, but it is being polyfilled by the Polymer platform to begin with, so ugh.<br /><br />It is a shame, because defining an element in the JavaScript version of Polymer would work:<pre class=prettyprint><code>&lt;link rel="import" href="hello-you-en.json"><br />&lt;link rel="import" href="hello-you-fr.json"><br />&lt;link rel="src" href="hello-you-es.json"><br />&lt;polymer-element name="hello-you"></code></pre>It is possible to access the <code>&lt;link></code> elements via the Polymer's <code>element</code> property:<pre class="prettyprint">this.element.previousElementSibling.import.textContent</pre>Actually, now that I think of it, this is not even possible in non-transformed Dart Polymers. The <code>declaration</code> property of a Polymer is the closest analogy to Polymer's <code>element</code> property, but it does not include the <code>&lt;link></code> elements in the <code>previousSiblingElement</code> property.<br /><br />Bother.<br /><br />So after all that, life on the bleeding edge remains a little rough. I still think the <code>&lt;link></code> import solution is a nice one for loading configuration data in regular Polymer. But in the Dart-flavored Polymer, it is looking more and more as if I will need to rely on <code>&lt;polymer-ajax></code> to load this kind of data.<br /><br /><br /><span style="color: #ccc">Day #979</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2013/12/cant-link-import-in-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2013/12/dart-transformers-for-polymer-cleanup.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
