---
title: 'Cannot Minify Polymer.dart'
layout: post
tags:
    - chain
    - dart
    - dartlang
    - deployment
    - polymer
category: japhr-by-chris-strom
published: '2014-01-05T23:59:00-05:00'

---

<div class=top-chain-links></div><br />I very much want to put a working example of <code>&lt;ice-code-editor></code> up for public consumption. This is the <a href="http://www.polymer-project.org/">Polymer</a> version of the <a href="https://github.com/eee-c/ice-code-editor">ICE Code Editor</a>. After the work of the past few days, I could do so—especially after figuring out how to swap out the debugging libraries for minified versions upon deployment. But deployment on the web usually means codebases that are south of the 2.5MB range.<br /><br />And, unfortunately for me, that is where my Polymer currently resides:<pre class=prettyprint>ls -lh build/polymer.html*<br />-rw-r--r-- 1 chris chris  797 Jan  5 12:11 build/polymer.html<br />-rw-r--r-- 1 chris chris 2.6M Jan  5 22:12 build/polymer.html_bootstrap.dart.js</pre>Although I might prefer to fix the root of the problem, that might take me more time than I have at my disposal. Since I am getting rather adept at writing <a href="http://dartlang.org">Dart</a> deployment transformers, I thought I might have a go at transforming that <code>polymer.html_bootstrap.dart.js</code> file. Its problem is that it contains the entire Dart core in JavaScript form. Since I have no need of web audio, web sql, svg, <i>etc.</i>, I try manually removing their definitions from <code>polymer.html_bootstrap.dart.js</code>. Sadly, that gets me nowhere. Even if my code is not directly using these libraries, other parts of the JavaScript are using them. It was worth a go.<br /><br />If I cannot treat the symptoms, let's see about the root cause of the problem. I start by upgrading the various “any” version dependencies that are present:<pre class="prettyprint">➜  ice-code-editor git:(polymer) ✗ pub upgrade<br />Resolving dependencies...............................................<br />Downloading js 0.2.1 from hosted...<br />Downloading browser 0.9.1 from hosted...<br />Dependencies upgraded!</pre>That actually seems promising. I know, for instance, that the js-interop package recently <a href="https://github.com/dart-lang/js-interop/issues/130">closed a bug</a> that was causing excessive <code>dart2js</code> code sizes.<br /><br />So I <code>pub build</code> my Polymer to find:<pre class=prettyprint>➜  ice-code-editor git:(polymer) ✗ pub build<br />...<br />[Warning in Dart2JS]:<br />web/polymer.html_bootstrap.dart:1:1: Hint: 449 methods retained for use by dart:mirrors out of 2399 total methods (19%).<br />...<br />[Info in Dart2JS]:<br />Generated ice_code_editor|web/polymer.html_bootstrap.dart.js (416281 characters) in 0:00:09.092775<br /></pre>That is an improvement. Not only the in size, which really is less:<pre class="prettyprint">➜  ice-code-editor git:(polymer) ✗ ls -lh build/polymer.html*<br />-rw-r--r-- 1 chris chris  797 Jan  5 22:52 build/polymer.html<br />-rw-r--r-- 1 chris chris 407K Jan  5 22:52 build/polymer.html_bootstrap.dart.js</pre>The build time is also less than half what it was. Great!<br /><br />Except that now the Polymer will not run. Instead, I get:<pre class="prettyprint">Uncaught Error: NoSuchMethodError : method not found: 'Symbol("giR")'<br />Receiver: Instance of 'pk'<br />Arguments: [] polymer.html_bootstrap.dart.js:1846<br />Stack Trace: <br />Error<br />    at Object.b (http://localhost:8000/polymer.html_bootstrap.dart.js:1117:3)<br />    at pk.a.T (http://localhost:8000/polymer.html_bootstrap.dart.js:6138:25)<br />    at pk.T (http://localhost:8000/polymer.html_bootstrap.dart.js:8671:22)<br />    at pk.giR (http://localhost:8000/polymer.html_bootstrap.dart.js:13237:59)<br />    at cz.A0 (http://localhost:8000/polymer.html_bootstrap.dart.js:8376:8)<br />    at Fv.call$1 (http://localhost:8000/polymer.html_bootstrap.dart.js:8508:34)<br />    at vs.GP (http://localhost:8000/polymer.html_bootstrap.dart.js:3505:34)<br />    at jb.call$0 (http://localhost:8000/polymer.html_bootstrap.dart.js:3653:25)<br />    at Object.T8 (http://localhost:8000/polymer.html_bootstrap.dart.js:3272:26)<br />    at R8.Gr (http://localhost:8000/polymer.html_bootstrap.dart.js:4595:25)<br /> polymer.html_bootstrap.dart.js:1846</pre>It seems that this error has been seen once before. Only once, as best I can tell. <a href="http://japhr.blogspot.com/2013/06/deploying-dart-code-to-github-pages.html">By me</a>.<br /><br />I always love it when that happens. It seems that I am doing something wrong in a way that is uniquely me. No one else is wrongheaded in quite the same way as me. I could definitely use a pair at this point, but failing that, I try my solution from back then: building the code without minifying it. But how to do that?<br /><br />The <a href="http://pub.dartlang.org/doc/pub-build.html">pub build</a> page suggests using the <code>--mode=debug</code> option. That does not seem to work:<pre class=prettyprint>➜  ice-code-editor git:(polymer) ✗ pub build --mode=debug         <br />Could not find an option named "mode".<br />Run "pub help" to see available options.</pre>And, sadly, I cannot figure this out. I know there must be a way to get this working in debug (non-minified) mode, but I cannot find it.<br /><br /><b>Update:</b> I was able to finally get this working. The option is <code>--no-minify</code>, not <code>--mode=debug</code>. The end result is that I am less than half of what I started with, but am still uncomfortably large:<pre class="prettyprint">➜  ice-code-editor git:(polymer) ✗ ls -lh build/polymer.html*<br />-rw-r--r-- 1 chris chris  801 Jan  6 00:07 build/polymer.html<br />-rw-r--r-- 1 chris chris 945K Jan  6 00:07 build/polymer.html_bootstrap.dart.js</pre>I may have a go at tweaking some of the JavaScript interoperability code in the ICE Code Editor tomorrow to see if that might fix my minified version of the code.<br /><br /><br /><br /><span style="color: #ccc">Day #987</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/building-minified-polymer-libraries.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/01/too-many-parts.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script>
