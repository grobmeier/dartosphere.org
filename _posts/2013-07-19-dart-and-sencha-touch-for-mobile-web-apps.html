---
title: 'Dart and Sencha Touch for Mobile Web Apps'
layout: post
tags:
    - dart
    - dartlang
    - mobileweb
    - sencha
    - senchatouch
category: seth-ladds-blog
published: '2013-07-19T06:00:00-07:00'

---

<div>You can use <a href="http://www.dartlang.org/articles/js-dart-interop/">Dart's JS-Interop</a> to integrate Dart code into your existing <a href="http://www.sencha.com/products/touch">Sencha Touch</a> application. This allows you to take advantage of Sencha Touch's mobile-first framework and Dart's productivity, language, and libraries.</div><div><br /></div><div><span style="font-size: large;">Preface</span></div><div><br /></div><b>Sencha Touch is a full-featured JavaScript framework for mobile web apps</b>. It supports layouts for multiple devices, touch, lots of widgets, models, a resource framework, and more. I've used Ext JS (a cousin of Sencha Touch) in a previous job, and was quite happy.<br /><div><br /></div><div>I'm also quite happy with Dart, the new scalable web programming platform from Google. <b>Dart compiles to JavaScript, and even interoperates with JavaScript.</b> It's a new language, libraries, package manager, VM (for client AND server apps), and rich tools. I feel really productive in Dart.</div><div><br /></div><div>I've never used Sencha Touch, so my first question was: <b>how do I insert Dart into an existing Sencha Touch application?</b></div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><img border="0" height="640" src="http://2.bp.blogspot.com/-KQRShKnUedg/UeikodmI3FI/AAAAAAAAYow/kJGrFbGMK0c/s640/download-2.png" width="380" /></div><div><br /></div><div><br /></div><div><span style="font-size: large;">Getting Sencha Touch</span></div><div><br /></div><div>Sencha already has great docs, so I won't repeat them here. This post assumes you have a Sencha Touch app already, but if not, check out&nbsp;<a href="http://www.sencha.com/products/touch">http://www.sencha.com/products/touch</a>. Make sure to download both the SDK and the sencha command line utility. I needed both to get started.<br /><br /><div class="separator" style="clear: both; text-align: center;"><img border="0" height="409" src="http://3.bp.blogspot.com/-WG_-WeZFbiI/Ueinzg7vPEI/AAAAAAAAYpI/KwElvB-DsDE/s640/Screen+Shot+2013-07-18+at+10.40.31+PM.png" width="640" /></div><br /></div><div><br /></div><div><span style="font-size: large;">Getting Dart</span></div><div><br /></div><div>Installing Dart is super easy. The best way is to <a href="http://www.dartlang.org/tools/editor/">install Dart Editor</a>, which includes the editor, Dart SDK, and Dartium (Chromium&nbsp;+ an embedded Dart VM). Even if you don't intent to use the editor, you almost certainly want Dartium for easy development testing (think: edit, reload, there is no step three).<br /><br /><div class="separator" style="clear: both; text-align: center;"><img border="0" height="173" src="http://www.dartlang.org/logos/dart-logo-wordmark.png" width="400" /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">If you are new to Dart, might I recommend the <a href="https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html">Language Tour</a> and the <a href="http://www.dartlang.org/docs/tutorials/">Tutorials</a>.</div><br /><br /><span style="font-size: large;">The Setup</span><br /><br />There are effectively two apps in play:<br /><br /><ol><li>The Sencha Touch app</li><li>The Dart app</li></ol><div>Both apps need to fully initialize and load (possibly loading multiple scripts) and there's no guarantee that one app will load before the other.</div><div><br /></div><div>The Dart app needs a way get a handle on the Sencha App, but only&nbsp;<i>after</i>&nbsp;the Sencha app is loaded and initialized. This scheme needs to work in both Dartium (JS and Dart VM) and across the web (via dart2js, which compiles Dart into JavaScript).</div></div><div><br /></div><div><span style="font-size: large;">Modify your Sencha Touch app</span></div><div><br /></div><div><i>(Note: I'm a Sencha Touch n00b, so maybe there's a better way. Please let me know in the comments.)</i></div><div><br /></div><div>This isn't pretty, but here's what I did:</div><div><br /></div><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> var senchaLaunchComplete = false;  <br /> Ext.application({  <br />   // ....  <br />   launch: function() {  <br />     // ...  <br />     senchaLaunchComplete = true;  <br />   },  <br /> });  <br /></code></pre><br />Notice I added a global "senchaLaunchComplete" variable that flips to <i>true</i>&nbsp;when the launch is complete. Again, not proud of this, and I'd like to learn more about how Sencha initializes. I can't fire a postMessage event from the Sencha App because it might get lost before the Dart app has a chance to load and initialize.<br /><br />Ideas welcome, but let's move on, shall we? :)<br /><br /><span style="font-size: large;">Waiting for the Sencha app to load</span><br /><br />The Dart app starts by repeatedly polling the <i>senchaLaunchComplete</i>&nbsp;variable from JavaScript. Dart uses JS-Interop to reach into the JavaScript world. JS-Interop works in both Dartium and when compiled with dart2js.<br /><br />All Dart programs start with a <i>main()</i>&nbsp;function. This makes it very easy to understand where your program actually starts running. Inside main() I setup a <i>Timer</i>&nbsp;to check the variable. (Again, sorry for the ugly code.)<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"><br />import 'dart:html';<br />import 'dart:async';<br />import 'package:js/js.dart' as js;<br /><br />main() {  <br />  // TODO: make this better  <br />  new Timer.periodic(const Duration(milliseconds: 100), (Timer t) {  <br />   if (js.context.senchaLaunchComplete) {  <br />    initDart();  <br />    t.cancel();  <br />   }  <br />  });  <br /> }  <br /></code></pre><br /><br />When <i>senchaLaunchComplete</i>&nbsp;is true, <i>initDart()</i>&nbsp;runs and the timer stops. The <i>js.context</i>&nbsp;is a handle into the JavaScript side of the world.<br /><br /><span style="font-size: large;">Adding a button and panel with Dart</span><br /><br />Now that both apps are loaded, and initialized, Dart code can add new objects to the Sencha Touch app. Let's add a new panel, which contains some text and a button.<br /><br />Sencha Touch apps can be declared with JSON, or imperatively constructed. I show both methods below. Remember, everything that follows is Dart code:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> initDart() {  <br />  // Grab the app's main panel  <br />  var mainPanel = js.context.Ext.Viewport.items.getAt(0);  <br />    <br />  // You can create a new object imperatively using a Proxy  <br />  var button = new js.Proxy(js.context.Ext.Button)  <br />   ..setText('Click Me')  <br />   ..setHandler(new js.Callback.many((b, e, _, __) {  <br />    // Respond to clicks with callbacks  <br />    js.context.Ext.Msg.alert('Success!', 'This is a Dart function, run from JavaScript.');  <br />   }));  <br />    <br />  // You can also create objects declaratively using ExtJS style.  <br />  var dartPanel = js.map({  <br />   'title': 'From Dart',  <br />   'iconCls': 'star',  <br />   'html': 'Hello from Dart! This panel was created from Dart code.',  <br />   'items': [button]  <br />  });  <br />    <br />  // Add the panel from Dart land into JS land  <br />  mainPanel.add(dartPanel);  <br /> }  <br /></code></pre><br />The main panel was constructed by the main Sencha Touch app over in JavaScript land. We get a handle to the main panel via JS-Interop and the js.context.<br /><br />Use <i>js.Proxy</i>&nbsp;to construct a new JavaScript object and get its reference. In the code above, a new <i>Ext.Button</i>&nbsp;is created from Dart, and configured. The double-dot syntax (..) is <i>method cascades</i>:&nbsp;<a href="https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html#classes">https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html#classes</a><br /><br />Notice a click handler is installed on the button, as a <i>js.Callback</i>. The callback can be fired multiple times. When the button is clicked, a new <i>Ext.Msg.alert</i>&nbsp;is displayed.<br /><br />The new panel is created as an example of Sencha's declarative configuration. The <i>js.map</i>&nbsp;is an efficient way to convert a Dart map into a JavaScript object. Notice how the Dart map contains a direct reference to the button (a Proxy object).<br /><br />The new panel, which contains the button, is then added to the main panel. This combines the two worlds.<br /><br /><span style="font-size: large;">Screenshots</span><br /><br />The star button comes from Dart. The home button comes for JavaScript. They basically are hugging! :)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-hp3G4qK_8B8/UeiwXd2y8WI/AAAAAAAAYpY/cjipQDwVpn0/s1600/framed_Screenshot_2013-07-18-22-03-06.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://1.bp.blogspot.com/-hp3G4qK_8B8/UeiwXd2y8WI/AAAAAAAAYpY/cjipQDwVpn0/s640/framed_Screenshot_2013-07-18-22-03-06.png" width="382" /></a></div><br />When the button is clicked, it calls a Dart function. How cool!<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-bCth_onM75I/UeiwkvkuMHI/AAAAAAAAYpg/dP45fUkaei8/s1600/framed_Screenshot_2013-07-18-22-03-10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://3.bp.blogspot.com/-bCth_onM75I/UeiwkvkuMHI/AAAAAAAAYpg/dP45fUkaei8/s640/framed_Screenshot_2013-07-18-22-03-10.png" width="382" /></a></div><br /><br /><span style="font-size: large;">All the code (and details)</span><br /><br />The code for a sample Sencha Touch&nbsp;+ Dart app is available here:&nbsp;<a href="https://github.com/sethladd/dart-sencha-touch-demo">https://github.com/sethladd/dart-sencha-touch-demo</a>. &nbsp;You'll need the sample code to see how a Dart application is arranged, and how to include both the Sencha JavaScript files and the Dart files. Specifically, check out&nbsp;<a href="https://github.com/sethladd/dart-sencha-touch-demo/blob/master/web/index.html">https://github.com/sethladd/dart-sencha-touch-demo/blob/master/web/index.html</a><br /><br /><span style="font-size: large;">What's next?</span><br /><br />This small demo simply shows how to insert some Dart logic into an existing Sencha Touch app. However, Sencha Touch is quite full featured, and there are more areas to explore. For example, how to interact with a Sencha model from Dart? How to create a Dart class and use it as a Sencha model? Good topics for future posts!<br /><br /><span style="font-size: large;">Summary</span><br /><br />You can extend an existing Sencha Touch app with Dart with Dart's JS-Interop. If you use Sencha Touch for your mobile HTML5 web apps, try using Dart's language, libraries, and tools as you add new features to your app. Go forth and build awesome mobile-first web apps!<img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/9QJhcodQUCg" height="1" width="1"/>
